"use strict";(self.webpackChunkstlite=self.webpackChunkstlite||[]).push([[5133],{95133:(e,t,o)=>{o.r(t),o.d(t,{default:()=>xe});var i=o(30969),n=o(46008),r=o(16868),l=o(61400),a=o(82919),s=o(98862),c=o(3077),d=o(53757),h=o(36599),u=o(22025),g=o(2313),m=o(91439);var p=o(47814),b=o.n(p),f=o(13524),y=o(65710),v=o(24760),w=o(64756),S=o(35354),x=o(37574);const j=e=>{let{error:t,width:o,deltaType:i}=e;return t instanceof C?(0,x.jsx)(S.Z,{width:o,name:"No Mapbox token provided",message:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("p",{children:["To use ",(0,x.jsxs)("code",{children:["st.",i]})," or ",(0,x.jsx)("code",{children:"st.map"})," you need to set up a Mapbox access token."]}),(0,x.jsxs)("p",{children:["To get a token, create an account at"," ",(0,x.jsx)("a",{href:"https://mapbox.com",children:"https://mapbox.com"}),". It's free for moderate usage levels!"]}),(0,x.jsxs)("p",{children:["Once you have a token, just set it using the Streamlit config option ",(0,x.jsx)("code",{children:"mapbox.token"})," and don't forget to restart your Streamlit server at this point if it's still running, then reload this tab."]}),(0,x.jsxs)("p",{children:["See"," ",(0,x.jsx)("a",{href:"https://docs.streamlit.io/develop/api-reference/configuration/config.toml",children:"our documentation"})," ","for more info on how to set config options."]})]})}):t instanceof k?(0,x.jsx)(S.Z,{width:o,name:"Error fetching Streamlit Mapbox token",message:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("p",{children:"This app requires an internet connection."}),(0,x.jsx)("p",{children:"Please check your connection and try again."}),(0,x.jsxs)("p",{children:["If you think this is a bug, please file bug report"," ",(0,x.jsx)("a",{href:"https://github.com/streamlit/streamlit/issues/new/choose",children:"here"}),"."]})]})}):(0,x.jsx)(S.Z,{width:o,name:"Error fetching Streamlit Mapbox token",message:t.message})};class C extends Error{}class k extends Error{}const F="https://data.streamlit.io/tokens.json",M="mapbox",Z=e=>t=>{class o extends i.PureComponent{constructor(o){super(o),this.context=void 0,this.initMapboxToken=async()=>{try{const e=await f.Z.get(F),{[M]:t}=e.data;if(!t)throw new Error(`Missing token ${M}`);this.setState({mapboxToken:t,isFetching:!1})}catch(e){const t=(0,y.b)(e);throw this.setState({mapboxTokenError:t,isFetching:!1}),new k(`${t.message} (${F})`)}},this.render=()=>{const{mapboxToken:o,mapboxTokenError:i,isFetching:n}=this.state,{width:r}=this.props;return i?(0,x.jsx)(j,{width:r,error:i,deltaType:e}):n?(0,x.jsx)(v.O,{element:m.Od.create({style:m.Od.SkeletonStyle.ELEMENT})}):(0,x.jsx)(t,{...this.props,mapboxToken:o,width:r})},this.state={isFetching:!0,mapboxToken:void 0,mapboxTokenError:void 0}}componentDidMount(){const e=this.props.element.mapboxToken||this.context.libConfig.mapboxToken;e?this.setState({mapboxToken:e,isFetching:!1}):this.initMapboxToken()}}return o.displayName=`withMapboxToken(${t.displayName||t.name})`,o.contextType=w.E,b()(o,t)};var T=o(83405);const N=(0,T.Z)("div",{target:"e1az0zs51"})((e=>{let{width:t,height:o}=e;return{position:"relative",height:o,width:t}}),""),E=(0,T.Z)("div",{target:"e1az0zs50"})((e=>{let{theme:t}=e;return{position:"absolute",right:"2.625rem",top:t.spacing.md,zIndex:1,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:t.colors.bgColor},"button:not(:disabled)":{background:t.colors.bgColor,"& + button":{borderTopColor:t.colors.secondaryBg},"&.mapboxgl-ctrl-icon:hover":{backgroundColor:(0,h.Iy)(t)?"":t.colors.darkenedBgMix25},"& span":{filter:(0,h.Iy)(t)?"":"invert(100%)"}}}}),"");var O=o(98441),I=o(15888),V=o.n(I),P=o(41045);var $=o(33567),A=o(33070),W=o(21283),J=o(19016),U=o(34708),z=o(12127),D=o(72620),L=o(36091);const B={classes:{...z,...o(81507),...L,...o(93578),CartoLayer:A.Z},functions:{colorBins:W.Z,colorCategories:J.Z,colorContinuous:U.Z}},G=new D.Z({configuration:B});var _=o(40748),q=o(2890),R=o(78007),X=o(34754),H=o(82156),K=o(22552),Q=o(69521),Y=o(20410),ee=o(69931),te=o(23554),oe=o(87516),ie=o(93988),ne=o(25536),re=o(58313),le=o(83863),ae=o(37639),se=o(51929),ce=o(41034),de=o(83974),he=o(8391);const ue={[ie.Z.layerName]:["getFillColor"],[ne.Z.layerName]:["getFillColor"],[re.ZP.layerName]:["getFillColor"],[le.Z.layerName]:["getFillColor"],[ae.Z.layerName]:["getFillColor"],[se.Z.layerName]:["getFillColor"],[ce.Z.layerName]:["getColor"],[_.Z.layerName]:["getTargetColor","getSourceColor"],[q.Z.layerName]:["getFillColor"],[R.Z.layerName]:["getFillColor"],[X.Z.layerName]:["getColor"],[H.Z.layerName]:["getColor"],[K.Z.layerName]:["getColor"],[Q.Z.layerName]:["getColor"],[Y.Z.layerName]:["getFillColor"],[ee.Z.layerName]:["getFillColor","getColor","getLineColor"],[te.Z.layerName]:["getFillColor"],[oe.Z.layerName]:["getColor"],[de.Z.layerName]:["getColor"],[he.Z.layerName]:["getColor"]},ge=e=>{let{isSelected:t,object:o,objectInfo:i,opacity:n,originalFillFunction:r}=e;const l=(e=>{let{object:t,objectInfo:o,originalFillFunction:i}=e;const n="function"===typeof i?i(t,o):i;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if("string"===typeof n&&n.startsWith("@@=")){const e=G.convert({originalColor:n}).originalColor(t);return[e[0]||0,e[1]||0,e[2]||0,e[3]||255]}return null})({object:o,objectInfo:i,originalFillFunction:r});if(!l)return null;let a=0;return a=t?Math.max("number"===typeof l[3]?l[3]:n,n):Math.min("number"===typeof l[3]?l[3]:n,n),[l[0]||0,l[1]||0,l[2]||0,a]},me={selection:{indices:{},objects:{}}},pe=(e,t)=>{const o=t.match(/{(.*?)}/g);return o&&o.forEach((o=>{const i=o.substring(1,o.length-1);e.object.hasOwnProperty(i)?t=t.replace(o,e.object[i]):e.object.hasOwnProperty("properties")&&e.object.properties.hasOwnProperty(i)&&(t=t.replace(o,e.object.properties[i]))})),t};function be(e,t){if(!t.id)return me;const o=e.getElementState(t.id,"selection");return null!==o&&void 0!==o?o:me}function fe(e,t){if(!t.id)return me;const o=e.getStringValue(t),i=o?O.Z.parse(o):null;return null!==i&&void 0!==i?i:me}function ye(e,t,o,i){e.id&&t.setStringValue(e,JSON.stringify(o.value),{fromUi:o.fromUi},i)}const ve=e=>{var t;const{element:o,fragmentId:n,height:r,isFullScreen:l,isLightTheme:a,theme:s,widgetMgr:c,width:d}=e,{selectionMode:h,tooltip:u,useContainerWidth:g}=o,m=null!==l&&void 0!==l&&l,[p,b]=(0,$.P)({element:o,getDefaultState:be,getStateFromWidgetMgr:fe,updateWidgetMgrState:ye,widgetMgr:c,fragmentId:n}),[f,y]=(0,i.useState)({bearing:0,pitch:0,zoom:11}),{height:v,width:w}=(e=>{let{container:t,element:o,heightFallback:n="auto",isFullScreen:r,shouldUseContainerWidth:l,widthFallback:a="auto"}=e;return{width:(0,i.useMemo)((()=>l||r?"100%":o.width||t.width||a),[t.width,o.width,r,l,a]),height:(0,i.useMemo)((()=>r&&t.height?t.height:o.height||t.height||n),[r,o.height,t.height,n])}})({element:o,isFullScreen:m,shouldUseContainerWidth:g,container:{height:r,width:d},heightFallback:(null===(t=f.initialViewState)||void 0===t?void 0:t.height)||500}),[S,x]=(0,i.useState)({}),j=h[0],C=void 0!==j,k=C&&Object.keys(p.selection.indices).length>0,F=(0,i.useMemo)((()=>Object.freeze(O.Z.parse(o.json))),[m,a,o.json]),M=(0,i.useMemo)((()=>{const e={...F};if(e.mapStyle||(e.mapStyle=`mapbox://styles/mapbox/${a?"light":"dark"}-v9`),m?Object.assign(e.initialViewState,{width:w,height:v}):(e.initialViewState.height||(e.initialViewState.height=500),g&&(e.initialViewState.width=w)),e.layers){const t=Object.values(p.selection.indices).some((e=>null===e||void 0===e?void 0:e.length)),o=e.layers.some((e=>Object.hasOwn(e,"pickable")));e.layers=e.layers.map((e=>{var i,n;if(!e||Array.isArray(e)||!C)return e;o||(e.pickable=!0);const r=`${e.id||null}`,l=(null===p||void 0===p||null===(i=p.selection)||void 0===i||null===(n=i.indices)||void 0===n?void 0:n[r])||[],a=ue[e["@@type"]];if(!a)return e;const c={...e};return a.forEach((o=>{var i;c.updateTriggers={[o]:[...(null===(i=c.updateTriggers)||void 0===i?void 0:i[o])||[],l,t]};const n=!t,r=e[o];if(n||!r)return c;const a=Math.floor(102),d=(0,P.dF)(s.colors.primary),h=[d[0],d[1],d[2],255],u=(0,P.dF)(s.colors.gray20),g=[u[0],u[1],u[2],a];c[o]=(e,t)=>(e=>{let{isSelected:t,object:o,objectInfo:i,originalFillFunction:n,selectedColor:r,selectedOpacity:l=255,unselectedColor:a,unselectedOpacity:s=Math.floor(102)}=e;return t?ge({opacity:l,isSelected:!0,object:o,objectInfo:i,originalFillFunction:n})||r:ge({opacity:s,isSelected:!1,object:o,objectInfo:i,originalFillFunction:n})||a})({isSelected:l.includes(t.index),object:e,objectInfo:t,originalFillFunction:r,selectedColor:h,unselectedColor:g,selectedOpacity:255,unselectedOpacity:a})})),c}))}return null===e||void 0===e||delete e.views,G.convert(e)}),[p.selection.indices,v,m,a,C,F,g,s.colors.gray20,s.colors.primary,w]);(0,i.useEffect)((()=>{if(!V()(M.initialViewState,S)){const e=Object.keys(M.initialViewState).reduce(((e,t)=>M.initialViewState[t]===S[t]?e:{...e,[t]:M.initialViewState[t]}),{});y({...f,...e}),x(M.initialViewState)}}),[M.initialViewState,S,f]);const Z=(0,i.useCallback)((e=>{if(!e||!e.object||!u)return null;const t=O.Z.parse(u);return t.html?t.html=pe(e,t.html):t.text=pe(e,t.text),t}),[u]),T=(0,i.useCallback)((e=>{let{viewState:t}=e;y(t)}),[y]);return{createTooltip:Z,data:p,deck:M,hasActiveSelection:k,height:v,isSelectionModeActivated:C,onViewStateChange:T,selectionMode:j,setSelection:b,viewState:f,width:w}};o(12815);(0,s.fh)([l.w,a.E]);const we=me.selection,Se=[],xe=Z("st.pydeck_chart")((0,g.Z)((e=>{const{collapse:t,disabled:o,disableFullscreenMode:l,element:a,expand:s,fragmentId:g,height:p,isFullScreen:b,mapboxToken:f,widgetMgr:y,width:v}=e,{mapboxToken:w}=a,S=(0,c.u)(),{createTooltip:j,data:C,deck:k,hasActiveSelection:F,height:M,isSelectionModeActivated:Z,onViewStateChange:T,selectionMode:O,setSelection:I,viewState:V,width:P}=ve({element:a,fragmentId:g,height:p,isFullScreen:b,isLightTheme:(0,h.Iy)(S),theme:S,widgetMgr:y,width:v}),[$,A]=(0,i.useState)(!1);(0,i.useEffect)((()=>{A(!0)}),[]);const W=(0,i.useCallback)((e=>{var t;if(void 0===O)return;const{index:o,object:i}=e,n=`${(null===(t=e.layer)||void 0===t?void 0:t.id)||null}`,r=C,l=-1===o,a=(()=>{if(l)return we;switch(O){case m.oJ.SelectionMode.SINGLE_OBJECT:var e;return(null===(e=r.selection.indices[n])||void 0===e?void 0:e[0])===o?we:{indices:{[`${n}`]:[o]},objects:{[`${n}`]:[i]}};case m.oJ.SelectionMode.MULTI_OBJECT:{const e=new Map(((null===r||void 0===r||null===(t=r.selection)||void 0===t||null===(a=t.indices)||void 0===a?void 0:a[n])||[]).map(((e,t)=>{var o,i,l;return[e,null===(o=r.selection)||void 0===o||null===(i=o.objects)||void 0===i||null===(l=i[n])||void 0===l?void 0:l[t]]})));if(e.has(o)?e.delete(o):e.set(o,i),0===e.size){const{[n]:e,...t}=r.selection.indices,{[n]:o,...i}=r.selection.objects;return{indices:t,objects:i}}return{indices:{...r.selection.indices,[`${n}`]:Array.from(e.keys())},objects:{...r.selection.objects,[`${n}`]:Array.from(e.values())}}}default:throw(e=>{throw new Error(`Reached a branch with non-exhaustive item: ${e}`)})(O),new Error("Invalid selection mode")}var t,a})();JSON.stringify(a)!==JSON.stringify(r.selection)&&I({fromUi:!0,value:{selection:a}})}),[O,C,I]),J=(0,i.useCallback)((()=>{I({value:{selection:we},fromUi:!0})}),[I]);return(0,x.jsxs)(N,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",width:P,height:M,children:[(0,x.jsx)(u.Z,{isFullScreen:b,disableFullscreenMode:l,onExpand:s,onCollapse:t,target:N,locked:!(!F||o)||void 0,children:F&&!o&&(0,x.jsx)(u.J,{label:"Clear selection",onClick:J,icon:d.x})}),(0,x.jsxs)(n.Z,{viewState:V,onViewStateChange:T,height:M,width:P,layers:$?k.layers:Se,getTooltip:j,ContextProvider:r.X$.Provider,controller:!0,onClick:Z&&!o?W:void 0,children:[(0,x.jsx)(r.Z3,{height:M,width:P,mapStyle:k.mapStyle&&("string"===typeof k.mapStyle?k.mapStyle:k.mapStyle[0]),mapboxApiAccessToken:w||f}),(0,x.jsx)(E,{children:(0,x.jsx)(r.Pv,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})}),!0))},33567:(e,t,o)=>{o.d(t,{P:()=>l,w:()=>a});var i=o(30969),n=o(23083),r=o(98170);function l(e){let{getStateFromWidgetMgr:t,getDefaultState:o,updateWidgetMgrState:l,element:a,widgetMgr:s,fragmentId:c}=e;const[d,h]=(0,i.useState)((()=>{var e;return null!==(e=t(s,a))&&void 0!==e?e:o(s,a)})),[u,g]=(0,i.useState)({value:d,fromUi:!1});(0,i.useEffect)((()=>{(0,r.le)(u)||(g(null),h(u.value),l(a,s,u,c))}),[u,l,a,s,c]);const m=(0,i.useCallback)((()=>{g({value:o(s,a),fromUi:!0})}),[g,a,o,s]);return(0,n.O)({widgetMgr:s,element:a,onFormCleared:m}),[d,g]}function a(e){let{getStateFromWidgetMgr:t,getDefaultStateFromProto:o,getCurrStateFromProto:n,updateWidgetMgrState:r,element:a,widgetMgr:s,fragmentId:c}=e;const d=(0,i.useCallback)(((e,t)=>o(t)),[o]),[h,u]=l({getStateFromWidgetMgr:t,getDefaultState:d,updateWidgetMgrState:r,element:a,widgetMgr:s,fragmentId:c});return(0,i.useEffect)((()=>{a.setValue&&(a.setValue=!1,u({value:n(a),fromUi:!1}))}),[a,n,u]),[h,u]}}}]);
//# sourceMappingURL=5133.a3e5166a.chunk.js.map