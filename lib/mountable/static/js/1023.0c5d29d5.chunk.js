"use strict";(self.webpackChunkstlite=self.webpackChunkstlite||[]).push([[1023],{22025:(e,t,r)=>{r.d(t,{J:()=>b,Z:()=>x});r(30969);var n=r(3077),i=r(65904),o=r(94914),a=r(21434),l=r(62606),s=r(64372),d=r(1454),c=r(77746),u=r(83405),g=r(36599);const p="-2.4rem",f=(0,u.Z)("div",{target:"e2wxzia1"})((e=>{let{theme:t,locked:r,target:n}=e;return{padding:`${t.spacing.sm} 0 ${t.spacing.sm} ${t.spacing.sm}`,position:"absolute",top:r?p:"-1rem",right:t.spacing.none,transition:"none",...!r&&{opacity:0,"&:active, &:focus-visible, &:hover":{transition:"opacity 150ms 100ms, top 100ms 100ms",opacity:1,top:p},...n&&{[`${n}:hover &, ${n}:active &, ${n}:focus-visible &`]:{transition:"opacity 150ms 100ms, top 100ms 100ms",opacity:1,top:p}}}}}),""),h=(0,u.Z)("div",{target:"e2wxzia0"})((e=>{let{theme:t}=e;return{color:(0,g.Iy)(t)?t.colors.fadedText60:t.colors.bodyText,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",boxShadow:"1px 2px 8px rgba(0, 0, 0, 0.08)",borderRadius:t.radii.default,backgroundColor:t.colors.lightenedBg05,width:"fit-content",zIndex:t.zIndices.sidebar+1}}),"");var m=r(37574);function b(e){let{label:t,show_label:r,icon:i,onClick:o}=e;const u=(0,n.u)(),g=r?t:"";return(0,m.jsx)("div",{"data-testid":"stElementToolbarButton",children:(0,m.jsx)(l.Z,{content:(0,m.jsx)(a.ZP,{source:t,allowHTML:!1,style:{fontSize:u.fontSizes.sm}}),placement:l.u.TOP,onMouseEnterDelay:1e3,inline:!0,children:(0,m.jsxs)(s.ZP,{onClick:e=>{o&&o(),e.stopPropagation()},kind:d.nW.ELEMENT_TOOLBAR,"aria-label":t,children:[i&&(0,m.jsx)(c.Z,{content:i,size:"md",testid:"stElementToolbarButtonIcon"}),g&&(0,m.jsx)("span",{children:g})]})})})}const x=e=>{let{onExpand:t,onCollapse:r,isFullScreen:n,locked:a,children:l,target:s,disableFullscreenMode:d}=e;return(0,m.jsx)(f,{className:"stElementToolbar","data-testid":"stElementToolbar",locked:a||n,target:s,children:(0,m.jsxs)(h,{children:[l,t&&!d&&!n&&(0,m.jsx)(b,{label:"Fullscreen",icon:i.i,onClick:()=>t()}),r&&!d&&n&&(0,m.jsx)(b,{label:"Close fullscreen",icon:o.m,onClick:()=>r()})]})})}},41023:(e,t,r)=>{r.r(t),r.d(t,{default:()=>pe});var n=r(30969),i=r(3077),o=r(88199),a=r(11397),l=r(58491),s=r(15888),d=r.n(s),c=r(23083),u=r(22025),g=r(98170),p=r(36599),f=r(10275),h=r.n(f),m=r(91439),b=r(65710);var x=r(63705),y=r(62606),v=r(85668),w=r(8089);const C=e=>{var t;let{widgetMgr:r,id:i,key:o,defaultValue:a}=e;(0,n.useEffect)((()=>{const e=r.getElementState(i,o);(0,g.le)(e)&&(0,g.bb)(a)&&r.setElementState(i,o,a)}),[r,i,o,a]);const[l,s]=(0,n.useState)(null!==(t=r.getElementState(i,o))&&void 0!==t?t:a);return[l,(0,n.useCallback)((e=>{r.setElementState(i,o,e),s(e)}),[r,i,o])]};var j=r(83405),k=r(34088);const S=(0,j.Z)("div",{target:"e12wn80j15"})(""),I=(0,j.Z)("div",{target:"e12wn80j14"})((e=>{let{theme:t}=e;return{height:t.sizes.largestElementHeight,width:"100%",background:t.genericColors.secondaryBg,borderRadius:t.radii.default,marginBottom:t.spacing.twoXS,display:"flex",alignItems:"center",position:"relative",paddingLeft:t.spacing.xs,paddingRight:t.spacing.sm}}),""),U=(0,j.Z)("div",{target:"e12wn80j13"})({name:"82a6rk",styles:"flex:1"}),R=(0,j.Z)("div",{target:"e12wn80j12"})((e=>{let{show:t}=e;return{display:t?"block":"none"}}),""),E=(0,j.Z)("span",{target:"e12wn80j11"})((e=>{let{theme:t,isPlayingOrRecording:r}=e;return{margin:t.spacing.sm,fontFamily:t.fonts.monospace,color:r?t.genericColors.bodyText:t.colors.fadedText60,backgroundColor:t.genericColors.secondaryBg,fontSize:t.fontSizes.sm}}),""),F=(0,j.Z)("div",{target:"e12wn80j10"})((()=>({width:"100%",textAlign:"center",overflow:"hidden"})),""),Z=(0,j.Z)("span",{target:"e12wn80j9"})((e=>{let{theme:t}=e;return{color:t.colors.bodyText}}),""),L=(0,j.Z)("a",{target:"e12wn80j8"})(""),P=(0,j.Z)("div",{target:"e12wn80j7"})((e=>{let{theme:t}=e;return{height:t.sizes.largestElementHeight,display:"flex",justifyContent:"center",alignItems:"center"}}),""),M=(0,j.Z)("div",{target:"e12wn80j6"})((e=>{let{theme:t}=e;return{height:10,opacity:.2,width:"100%",backgroundImage:`radial-gradient(${t.colors.fadedText10} 40%, transparent 40%)`,backgroundSize:"10px 10px",backgroundRepeat:"repeat"}}),""),T=(0,j.Z)("span",{target:"e12wn80j5"})((e=>{let{theme:t}=e;return{"& > button":{color:t.colors.primary,padding:t.spacing.threeXS},"& > button:hover, & > button:focus":{color:t.colors.red}}}),""),W=(0,j.Z)("span",{target:"e12wn80j4"})((e=>{let{theme:t}=e;return{"& > button":{padding:t.spacing.threeXS,color:t.colors.fadedText40},"& > button:hover, & > button:focus":{color:t.colors.primary}}}),""),z=(0,j.Z)("span",{target:"e12wn80j3"})((e=>{let{theme:t}=e;return{"& > button":{padding:t.spacing.threeXS,color:t.colors.fadedText60},"& > button:hover, & > button:focus":{color:t.colors.bodyText}}}),""),A=(0,j.Z)("div",{target:"e12wn80j2"})((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:0,flexShrink:1,padding:t.spacing.xs,gap:t.spacing.twoXS,marginRight:t.spacing.twoXS}}),""),B=(0,j.Z)("div",{target:"e12wn80j1"})((e=>{let{theme:t}=e;return{marginLeft:t.spacing.sm}}),""),O=(0,j.Z)(k.Q,{target:"e12wn80j0"})((e=>{let{theme:t}=e;return{fontSize:t.fontSizes.sm,width:"1.375rem",height:"1.375rem",borderWidth:"3px",radius:t.radii.md,justifyContents:"center",padding:t.spacing.none,margin:t.spacing.none,borderColor:t.colors.borderColor,borderTopColor:t.colors.primary,flexGrow:0,flexShrink:0}}),"");var D=r(47394),H=r(37574);const N=()=>(0,H.jsxs)(F,{children:[(0,H.jsx)(Z,{children:"This app would like to use your microphone."})," ",(0,H.jsx)(L,{href:D.xN,children:"Learn how to allow access."})]}),V=()=>(0,H.jsx)(P,{children:(0,H.jsx)(M,{})}),$="00:00",X=e=>new Date(e).toLocaleTimeString(void 0,{minute:"2-digit",second:"2-digit"});var G=r(25473),J=r(7226),_=r(62721),K=r(19504),Q=r(15213),q=r(64372),Y=r(1454),ee=r(77746);const te=e=>{let{onClick:t,disabled:r,ariaLabel:n,iconContent:i}=e;return(0,H.jsx)(q.ZP,{kind:Y.nW.BORDERLESS_ICON,onClick:t,disabled:r,"aria-label":n,fluidWidth:!0,"data-testid":"stAudioInputActionButton",children:(0,H.jsx)(ee.Z,{content:i,size:"lg",color:"inherit"})})},re=e=>{let{disabled:t,stopRecording:r}=e;return(0,H.jsx)(T,{children:(0,H.jsx)(te,{onClick:r,disabled:t,ariaLabel:"Stop recording",iconContent:J.P})})},ne=e=>{let{disabled:t,isPlaying:r,onClickPlayPause:n}=e;return(0,H.jsx)(z,{children:r?(0,H.jsx)(te,{onClick:n,disabled:t,ariaLabel:"Pause",iconContent:_.d}):(0,H.jsx)(te,{onClick:n,disabled:t,ariaLabel:"Play",iconContent:K.J})})},ie=e=>{let{disabled:t,startRecording:r}=e;return(0,H.jsx)(W,{children:(0,H.jsx)(te,{onClick:r,disabled:t,ariaLabel:"Record",iconContent:G.u})})},oe=e=>{let{onClick:t}=e;return(0,H.jsx)(z,{children:(0,H.jsx)(te,{disabled:!1,onClick:t,ariaLabel:"Reset",iconContent:Q.h})})},ae=e=>{let{disabled:t,isRecording:r,isPlaying:n,isUploading:i,isError:o,recordingUrlExists:a,startRecording:l,stopRecording:s,onClickPlayPause:d,onClear:c}=e;return o?(0,H.jsx)(A,{children:(0,H.jsx)(oe,{onClick:c})}):i?(0,H.jsx)(A,{children:(0,H.jsx)(O,{"aria-label":"Uploading"})}):(0,H.jsxs)(A,{children:[r?(0,H.jsx)(re,{disabled:t,stopRecording:s}):(0,H.jsx)(ie,{disabled:t,startRecording:l}),a&&(0,H.jsx)(ne,{disabled:t,isPlaying:n,onClickPlayPause:d})]})},le=(0,n.memo)(ae);var se=r(1561);function de(e,t,r){for(let n=0;n<r.length;n++,t+=2){const i=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}const ce=async function(e){const t=new window.AudioContext,r=await e.arrayBuffer();let n;try{n=await t.decodeAudioData(r)}catch(u){return void(0,se.H)(u)}const i=n.numberOfChannels,o=n.sampleRate,a=n.length*i*2+44,l=new ArrayBuffer(a),s=new DataView(l),d={0:{type:"string",value:"RIFF"},4:{type:"uint32",value:36+2*n.length*i},8:{type:"string",value:"WAVE"},12:{type:"string",value:"fmt "},16:{type:"uint32",value:16},20:{type:"uint16",value:1},22:{type:"uint16",value:i},24:{type:"uint32",value:o},28:{type:"uint32",value:o*i*2},32:{type:"uint16",value:2*i},34:{type:"uint16",value:16},36:{type:"string",value:"data"},40:{type:"uint32",value:n.length*i*2}};Object.entries(d).forEach((e=>{let[t,{type:r,value:n}]=e;const i=parseInt(t,10);"string"===r?function(e,t,r){for(let n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))}(s,i,n):"uint32"===r?s.setUint32(i,n,!0):"uint16"===r&&s.setUint16(i,n,!0)}));for(let g=0;g<i;g++)de(s,44+g*n.length*2,n.getChannelData(g));const c=new Uint8Array(l);return new Blob([c],{type:"audio/wav"})},ue=()=>(0,H.jsx)(F,{children:(0,H.jsx)(Z,{children:"An error has occurred, please try again."})}),ge=e=>{var t;let{element:r,uploadClient:s,widgetMgr:f,fragmentId:j,disabled:k}=e;const F=(0,i.u)(),Z=(0,w.D)(F),[L,P]=(0,n.useState)(null),M=n.useRef(null),[T,W]=C({widgetMgr:f,id:r.id,key:"deleteFileUrl"}),[z,A]=(0,n.useState)(null),[O,D]=(0,n.useState)([]),[G,J]=(0,n.useState)(null),[_,K]=C({widgetMgr:f,id:r.id,key:"recordingUrl"}),[,Q]=(0,n.useState)(0),q=()=>{Q((e=>e+1))},[Y,ee]=(0,n.useState)($),[te,re]=C({widgetMgr:f,id:r.id,key:"recordingTime",defaultValue:$}),[ne,ie]=(0,n.useState)(!1),[oe,ae]=(0,n.useState)(!1),[se,de]=(0,n.useState)(!1),[ge,pe]=(0,n.useState)(!1),[fe,he]=(0,n.useState)(!1),me=r.id,be=r.formId,xe=(0,n.useCallback)((async e=>{let t;if(pe(!0),(0,g.bb)(be)&&f.setFormsWithUploadsInProgress(new Set([be])),t="audio/wav"===e.type?e:await ce(e),!t)return void he(!0);const r=URL.createObjectURL(t),n=new File([t],"audio.wav",{type:t.type});K(r),(async e=>{let{files:t,uploadClient:r,widgetMgr:n,widgetInfo:i,fragmentId:o}=e,a=[];try{a=await r.fetchFileURLs(t)}catch(c){return{successfulUploads:[],failedUploads:t.map((e=>({file:e,error:(0,b.b)(c)})))}}const l=h()(t,a),s=[],d=[];return await Promise.all(l.map((async e=>{let[t,n]=e;if(!t||!n||!n.uploadUrl||!n.fileId)return{file:t,fileUrl:n,error:new Error("No upload URL found")};try{await r.uploadFile({id:n.fileId,formId:i.formId||""},n.uploadUrl,t),s.push({fileUrl:n,file:t})}catch(c){const r=(0,b.b)(c);d.push({file:t,error:r})}}))),n.setFileUploaderStateValue(i,new m.xO({uploadedFileInfo:s.map((e=>{let{file:t,fileUrl:r}=e;return new m.jM({fileId:r.fileId,fileUrls:r,name:t.name,size:t.size})}))}),{fromUi:!0},o),{successfulUploads:s,failedUploads:d}})({files:[n],uploadClient:s,widgetMgr:f,widgetInfo:{id:me,formId:be},fragmentId:j}).then((e=>{let{successfulUploads:t,failedUploads:r}=e;if(r.length>0)return void he(!0);const n=t[0];n&&n.fileUrl.deleteUrl&&W(n.fileUrl.deleteUrl)})).finally((()=>{(0,g.bb)(be)&&f.setFormsWithUploadsInProgress(new Set),pe(!1)}))}),[K,s,f,me,be,j,W]),ye=(0,n.useCallback)((e=>{let{updateWidgetManager:t}=e;(0,g.le)(L)||(0,g.le)(T)||(K(null),L.empty(),s.deleteFile(T),ee($),re($),W(null),t&&f.setFileUploaderStateValue(r,{},{fromUi:!0},j),ie(!1),(0,g.bb)(_)&&URL.revokeObjectURL(_))}),[T,_,s,L,r,f,j,re,K,W]);(0,n.useEffect)((()=>{if((0,g.le)(be))return;const e=new c.K;return e.manageFormClearListener(f,be,(()=>{ye({updateWidgetManager:!0})})),()=>e.disconnect()}),[be,ye,f]);const ve=(0,n.useCallback)((()=>{if(null===M.current)return;const e=o.Z.create({container:M.current,waveColor:_?(0,p.NH)(F.colors.fadedText40,F.genericColors.secondaryBg):F.colors.primary,progressColor:F.colors.bodyText,height:parseFloat(getComputedStyle(document.documentElement).fontSize)*parseFloat(F.sizes.largestElementHeight.replace("rem",""))-8,barWidth:4,barGap:4,barRadius:8,cursorWidth:0,url:null!==_&&void 0!==_?_:void 0});e.on("timeupdate",(e=>{ee(X(1e3*e))})),e.on("pause",(()=>{q()}));const t=e.registerPlugin(a.Z.create({scrollingWaveform:!1,renderRecordedAudio:!0}));return t.on("record-end",(async e=>{xe(e)})),t.on("record-progress",(e=>{re(X(e))})),P(e),A(t),()=>{e&&e.destroy(),t&&t.destroy()}}),[xe]);(0,n.useEffect)((()=>ve()),[ve]),(0,n.useEffect)((()=>{d()(Z,F)||null===L||void 0===L||L.setOptions({waveColor:_?(0,p.NH)(F.colors.fadedText40,F.genericColors.secondaryBg):F.colors.primary,progressColor:F.colors.bodyText})}),[F,Z,_,L]);const we=(0,n.useCallback)((()=>{L&&(L.playPause(),ie(!0),q())}),[L]),Ce=(0,n.useCallback)((async()=>{let e=G;se||(await navigator.mediaDevices.getUserMedia({audio:!0}).then((()=>a.Z.getAvailableAudioDevices().then((t=>{if(D(t),t.length>0){const{deviceId:r}=t[0];J(r),e=r}})))).catch((e=>{ae(!0)})),de(!0)),z&&e&&L&&(L.setOptions({waveColor:F.colors.primary}),_&&ye({updateWidgetManager:!1}),z.startRecording({deviceId:e}).then((()=>{q()})))}),[G,z,F,L,_,ye,se]),je=(0,n.useCallback)((()=>{z&&(z.stopRecording(),null===L||void 0===L||L.setOptions({waveColor:(0,p.NH)(F.colors.fadedText40,F.genericColors.secondaryBg)}))}),[z,L,F]),ke=Boolean(null===z||void 0===z?void 0:z.isRecording()),Se=Boolean(null===L||void 0===L?void 0:L.isPlaying()),Ie=ke||Se,Ue=!ke&&!_&&!oe,Re=oe||Ue||fe,Ee=k||oe;return(0,H.jsxs)(S,{className:"stAudioInput","data-testid":"stAudioInput",children:[(0,H.jsx)(v.O,{label:r.label,disabled:Ee,labelVisibility:(0,g.iF)(null===(t=r.labelVisibility)||void 0===t?void 0:t.value),children:r.help&&(0,H.jsx)(B,{children:(0,H.jsx)(x.Z,{content:r.help,placement:y.u.TOP})})}),(0,H.jsxs)(I,{children:[(0,H.jsx)(u.Z,{isFullScreen:!1,disableFullscreenMode:!0,target:I,children:T&&(0,H.jsx)(u.J,{label:"Clear recording",icon:l.H,onClick:()=>ye({updateWidgetManager:!0}),"data-testid":"stAudioInputClearRecordingButton"})}),(0,H.jsx)(le,{isRecording:ke,isPlaying:Se,isUploading:ge,isError:fe,recordingUrlExists:Boolean(_),startRecording:Ce,stopRecording:je,onClickPlayPause:we,onClear:()=>{ye({updateWidgetManager:!1}),he(!1)},disabled:Ee}),(0,H.jsxs)(U,{children:[fe&&(0,H.jsx)(ue,{}),Ue&&(0,H.jsx)(V,{}),oe&&(0,H.jsx)(N,{}),(0,H.jsx)(R,{"data-testid":"stAudioInputWaveSurfer",ref:M,show:!Re})]}),(0,H.jsx)(E,{isPlayingOrRecording:Ie,"data-testid":"stAudioInputWaveformTimeCode",children:ne?Y:te})]})]})},pe=(0,n.memo)(ge)},23083:(e,t,r)=>{r.d(t,{K:()=>o,O:()=>a});var n=r(30969),i=r(98170);class o{constructor(){this.formClearListener=void 0,this.lastWidgetMgr=void 0,this.lastFormId=void 0}manageFormClearListener(e,t,r){(0,i.bb)(this.formClearListener)&&this.lastWidgetMgr===e&&this.lastFormId===t||(this.disconnect(),(0,i.bM)(t)&&(this.formClearListener=e.addFormClearedListener(t,r),this.lastWidgetMgr=e,this.lastFormId=t))}disconnect(){var e;null===(e=this.formClearListener)||void 0===e||e.disconnect(),this.formClearListener=void 0,this.lastWidgetMgr=void 0,this.lastFormId=void 0}}function a(e){let{element:t,widgetMgr:r,onFormCleared:o}=e;(0,n.useEffect)((()=>{if(!(0,i.bM)(t.formId))return;const e=r.addFormClearedListener(t.formId,o);return()=>{e.disconnect()}}),[t,r,o])}},8089:(e,t,r)=>{r.d(t,{D:()=>i});var n=r(30969);const i=e=>{const t=(0,n.useRef)();return(0,n.useEffect)((()=>{t.current=e}),[e]),t.current}}}]);
//# sourceMappingURL=1023.0c5d29d5.chunk.js.map