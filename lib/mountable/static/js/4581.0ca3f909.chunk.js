var stlite;!function(){"use strict";var e={84581:function(e,t,n){var r=n(59019),o=n(82333),a=n(57994),s=n(98907),i=function(){function e(){var t=this;(0,a.Z)(this,e),this.promise=new Promise((function(e,n){t.resolveInternal=e,t.rejectInternal=n}))}return(0,s.Z)(e,[{key:"resolve",value:function(e){this.resolveInternal(e)}},{key:"reject",value:function(e){this.rejectInternal(e)}}]),e}(),c=n(47427),l=n(22523),u=n.n(l);function p(e,t){var n,r=u().normalize(t),o=u().dirname(r).split("/"),a=[],s=(0,c.Z)(o);try{for(s.s();!(n=s.n()).done;){var i=n.value;a.push(i);var l=a.join("/");if(e.FS.analyzePath(l).exists){if(e.FS.isDir(l))throw new Error('"'.concat(l,'" already exists and is not a directory.'))}else try{e.FS.mkdir(l)}catch(p){throw console.error('Failed to create a directory "'.concat(l,'"')),p}}}catch(p){s.e(p)}finally{s.f()}}function g(e,t,n,r){p(e,t),e.FS.writeFile(t,n,r)}function d(e,t,n){p(e,n),e.FS.rename(t,n)}function f(e){e.forEach((function(e){var t;try{t=new URL(e)}catch(n){return}if("emfs:"===t.protocol||"file:"===t.protocol)throw new Error('"emfs:" and "file:" protocols are not allowed for the requirement ('.concat(e,")"))}))}function m(e){e.runPython('\nimport micropip\nmicropip.add_mock_package(\n    "pyarrow", "0.0.1",\n    modules={\n        "pyarrow": """\n__version__ = \'0.0.1\'  # TODO: Update when releasing\n\n\nclass Table:\n    @classmethod\n    def from_pandas(*args, **kwargs):\n        raise NotImplementedError("stlite is not supporting this method.")\n"""\n    }\n)\n')}var h,b,v=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))},_=self,y=new i;function k(e){_.postMessage({type:"event:progress",data:{message:e}})}function w(e,t){return v(this,void 0,void 0,(0,o.Z)().mark((function n(){var r,a,s;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.slice(0,e.lastIndexOf("/")+1),!e.endsWith(".mjs")){n.next=8;break}return n.next=4,import(e);case 4:s=n.sent,a=s.loadPyodide,n.next=10;break;case 8:importScripts(e),a=self.loadPyodide;case 10:return n.abrupt("return",a(Object.assign(Object.assign({},t),{indexURL:r})));case 11:case"end":return n.stop()}}),n)})))}var x=function(){return v(this,void 0,void 0,(0,o.Z)().mark((function e(){var t,n,a,s,i,c,l,u,p,d,x,P,S=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.promise;case 2:return t=e.sent,n=t.entrypoint,a=t.files,s=t.archives,i=t.requirements,c=t.wheels,l=t.mountedSitePackagesSnapshotFilePath,u=t.pyodideUrl,p=void 0===u?"https://cdn.jsdelivr.net/pyodide/v0.23.3/full/pyodide.js":u,d=t.streamlitConfig,k("Loading Pyodide."),console.debug("Loading Pyodide"),e.next=16,w(p,{stdout:console.log,stderr:console.error});case 16:return h=e.sent,console.debug("Loaded Pyodide"),k("Mounting files."),e.next=21,Promise.all(Object.keys(a).map((function(e){return v(S,void 0,void 0,(0,o.Z)().mark((function t(){var n,r,s;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("url"in(n=a[e]))){t.next=8;break}return console.debug("Fetch a file from ".concat(n.url)),t.next=5,fetch(n.url).then((function(e){return e.arrayBuffer()})).then((function(e){return new Uint8Array(e)}));case 5:r=t.sent,t.next=9;break;case 8:r=n.data;case 9:s=a[e].opts,console.debug('Write a file "'.concat(e,'"')),g(h,e,r,s);case 12:case"end":return t.stop()}}),t)})))})));case 21:return k("Unpacking archives."),e.next=24,Promise.all(s.map((function(e){return v(S,void 0,void 0,(0,o.Z)().mark((function t(){var n,r,a;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("url"in e)){t.next=7;break}return console.debug("Fetch an archive from ".concat(e.url)),t.next=4,fetch(e.url).then((function(e){return e.arrayBuffer()}));case 4:n=t.sent,t.next=8;break;case 7:n=e.buffer;case 8:r=e.format,a=e.options,console.debug("Unpack an archive",{format:r,options:a}),h.unpackArchive(n,r,a);case 11:case"end":return t.stop()}}),t)})))})));case 24:if(l||c){e.next=26;break}throw new Error("Neither snapshot nor wheel files are provided.");case 26:if(!l){e.next=40;break}return k("Restoring the snapshot."),e.next=30,h.runPythonAsync("import tarfile, shutil, site");case 30:return e.next=32,h.runPythonAsync("\n      site_packages_dirs = site.getsitepackages()\n      for site_packages in site_packages_dirs:\n          shutil.rmtree(site_packages)\n    ");case 32:return console.debug("Unarchive ".concat(l)),e.next=35,h.runPythonAsync('\n      with tarfile.open("'.concat(l,'", "r") as tar_gz_file:\n          tar_gz_file.extractall("/")\n    '));case 35:console.debug("Restored the snapshot"),k("Mocking some packages."),console.debug("Mock pyarrow"),m(h),console.debug("Mocked pyarrow");case 40:return f(i),k("Installing packages."),e.next=44,h.loadPackage("micropip");case 44:if(x=h.pyimport("micropip"),!c){e.next=58;break}return e.next=48,x.install("altair<5.2.0",{keep_going:!0});case 48:return console.debug("Installing the wheels:",c,"and the requirements:",i),e.next=51,x.install.callKwargs([c.stliteServer,c.streamlit].concat((0,r.Z)(i)),{keep_going:!0});case 51:console.debug("Installed the wheels and the requirements"),k("Mocking some packages."),console.debug("Mock pyarrow"),m(h),console.debug("Mocked pyarrow"),e.next=62;break;case 58:return console.debug("Installing the requirements:",i),e.next=61,x.install.callKwargs(i,{keep_going:!0});case 61:console.debug("Installed the requirements");case 62:return e.next=64,h.runPythonAsync("\n    import importlib\n    importlib.invalidate_caches()\n  ");case 64:return k("Loading streamlit package."),console.debug("Loading the Streamlit package"),e.next=68,h.runPythonAsync("\n      import streamlit.runtime\n      import streamlit.web\n  ");case 68:return console.debug("Loaded the Streamlit package"),k("Setting up the loggers."),console.debug("Setting the loggers"),e.next=73,h.runPythonAsync("\n      import logging\n      import streamlit.logger\n\n      streamlit.logger.get_logger = logging.getLogger\n      streamlit.logger.setup_formatter = None\n      streamlit.logger.update_formatter = lambda *a, **k: None\n      streamlit.logger.set_log_level = lambda *a, **k: None\n  ");case 73:return P=function(e){e.startsWith("CRITICAL")||e.startsWith("ERROR")?console.error(e):e.startsWith("WARNING")?console.warn(e):e.startsWith("INFO")?console.info(e):e.startsWith("DEBUG")?console.debug(e):console.log(e)},self.__logCallback__=P,e.next=77,h.runPythonAsync('\n      from js import __logCallback__\n\n\n      class JsHandler(logging.Handler):\n          def emit(self, record):\n              msg = self.format(record)\n              __logCallback__(msg)\n\n\n      main_formatter = logging.Formatter("%(levelname)s:%(name)s:%(message)s")\n\n      js_handler = JsHandler()\n      js_handler.setFormatter(main_formatter)\n\n      root_logger = logging.getLogger()\n      root_logger.handlers.clear()\n      root_logger.addHandler(js_handler)\n      root_logger.setLevel(logging.DEBUG)\n\n      streamlit_handler = logging.getLogger("streamlit")\n      streamlit_handler.setLevel(logging.DEBUG)\n  ');case 77:return console.debug("Set the loggers"),k("Mocking some Streamlit functions for the browser environment."),console.debug("Mocking some Streamlit functions"),e.next=82,h.runPythonAsync("\n    import streamlit\n\n    def is_cacheable_msg(msg):\n        return False\n\n    streamlit.runtime.runtime.is_cacheable_msg = is_cacheable_msg\n  ");case 82:return console.debug("Mocked some Streamlit functions"),k("Booting up the Streamlit server."),console.debug("Booting up the Streamlit server"),self.__streamlitFlagOptions__=Object.assign(Object.assign({},d),{"browser.gatherUsageStats":!1,"runner.fastReruns":!1}),e.next=88,h.runPythonAsync('\n    from stlite_server.bootstrap import load_config_options, prepare\n    from stlite_server.server import Server\n    from js import __streamlitFlagOptions__\n\n    flag_options = __streamlitFlagOptions__.to_py()\n    load_config_options(flag_options)\n\n    main_script_path = "'.concat(n,'"\n    command_line = None\n    args = []\n\n    prepare(main_script_path, args)\n\n    server = Server(main_script_path, command_line)\n    server.start()\n  '));case 88:console.debug("Booted up the Streamlit server"),console.debug("Setting up the HTTP server"),b=h.globals.get("server").copy(),console.debug("Set up the HTTP server"),_.postMessage({type:"event:loaded"});case 93:case"end":return e.stop()}}),e)})))}().catch((function(e){throw _.postMessage({type:"event:error",data:{error:e}}),e}));self.onmessage=function(e){return v(void 0,void 0,void 0,(0,o.Z)().mark((function t(){var n,r,a,s,i,c,l,u,p,m,v,k,w,P,S,j,M;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("initData"!==(n=e.data).type){t.next=4;break}return y.resolve(n.data),t.abrupt("return");case 4:return t.next=6,x;case 6:r=e.ports[0],t.prev=7,t.t0=n.type,t.next="websocket:connect"===t.t0?11:"websocket:send"===t.t0?16:"http:request"===t.t0?20:"file:write"===t.t0?25:"file:rename"===t.t0?30:"file:unlink"===t.t0?35:"install"===t.t0?40:46;break;case 11:return console.debug("websocket:connect",n.data),a=n.data.path,b.start_websocket(a,(function(e,t){if(t){var n=e.getBuffer("u8");e.destroy();var r=new Uint8ClampedArray(n.data.buffer,n.data.byteOffset,n.data.byteLength);_.postMessage({type:"websocket:message",data:{payload:new Uint8Array(r)}})}else _.postMessage({type:"websocket:message",data:{payload:e}})})),r.postMessage({type:"reply"}),t.abrupt("break",46);case 16:return console.debug("websocket:send",n.data),s=n.data.payload,b.receive_websocket_from_js(s),t.abrupt("break",46);case 20:return console.debug("http:request",n.data),i=n.data.request,c=function(e,t,n){var o=t.toJs(),a=n.toJs();console.debug({statusCode:e,headers:o,body:a});var s={type:"http:response",data:{response:{statusCode:e,headers:o,body:a}}};r.postMessage(s)},b.receive_http_from_js(i.method,i.path,i.headers,i.body,c),t.abrupt("break",46);case 25:return l=n.data,u=l.path,p=l.data,m=l.opts,console.debug('Write a file "'.concat(u,'"')),g(h,u,p,m),r.postMessage({type:"reply"}),t.abrupt("break",46);case 30:return v=n.data,k=v.oldPath,w=v.newPath,console.debug('Rename "'.concat(k,'" to ').concat(w)),d(h,k,w),r.postMessage({type:"reply"}),t.abrupt("break",46);case 35:return P=n.data.path,console.debug('Remove "'.concat(P)),h.FS.unlink(P),r.postMessage({type:"reply"}),t.abrupt("break",46);case 40:return S=n.data.requirements,j=h.pyimport("micropip"),console.debug("Install the requirements:",S),f(S),t.next=46,j.install.callKwargs(S,{keep_going:!0}).then((function(){if(S.includes("matplotlib"))return h.runPythonAsync("\n                from stlite_server.bootstrap import _fix_matplotlib_crash\n                _fix_matplotlib_crash()\n              ")})).then((function(){console.debug("Successfully installed"),r.postMessage({type:"reply"})}));case 46:t.next=57;break;case 48:if(t.prev=48,t.t1=t.catch(7),console.error(t.t1),t.t1 instanceof Error){t.next=53;break}throw t.t1;case 53:(M=new Error(t.t1.message)).name=t.t1.name,M.stack=t.t1.stack,r.postMessage({type:"reply",error:M});case 57:case"end":return t.stop()}}),t,null,[[7,48]])})))},_.postMessage({type:"event:start"})}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.x=function(){var e=n.O(void 0,[1561],(function(){return n(84581)}));return e=n.O(e)},function(){var e=[];n.O=function(t,r,o,a){if(!r){var s=1/0;for(u=0;u<e.length;u++){r=e[u][0],o=e[u][1],a=e[u][2];for(var i=!0,c=0;c<r.length;c++)(!1&a||s>=a)&&Object.keys(n.O).every((function(e){return n.O[e](r[c])}))?r.splice(c--,1):(i=!1,a<s&&(s=a));if(i){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,o,a]}}(),n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,r){return n.f[r](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".9adf68ec.chunk.js"},n.miniCssF=function(e){},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./",function(){var e={4581:1};n.f.i=function(t,r){e[t]||importScripts(n.p+n.u(t))};var t=self.webpackChunkstlite=self.webpackChunkstlite||[],r=t.push.bind(t);t.push=function(t){var o=t[0],a=t[1],s=t[2];for(var i in a)n.o(a,i)&&(n.m[i]=a[i]);for(s&&s(n);o.length;)e[o.pop()]=1;r(t)}}(),function(){var e=n.x;n.x=function(){return n.e(1561).then(e)}}();var r=n.x();stlite=r}();
//# sourceMappingURL=4581.0ca3f909.chunk.js.map