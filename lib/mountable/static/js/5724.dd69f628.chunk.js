"use strict";(self.webpackChunkstlite=self.webpackChunkstlite||[]).push([[5724],{75724:(t,e,i)=>{i.r(e),i.d(e,{default:()=>V});var a=i(30969),n=i(3077),s=i(62558),r=i.n(s),o=i(94409),h=i(85771),d=i(19541),l=i(1561),c=i(40551),u=i(68754),g=i(65710);i(43875),i(82624);const f=(0,i(83405).Z)("div",{target:"ebiq7ng0"})((t=>{let{theme:e}=t;return{"&.vega-embed":{".vega-actions":{zIndex:e.zIndices.popupMenu},summary:{height:"auto",zIndex:e.zIndices.menuButton}}}}),"");var p=i(37574);const m={DATAFRAME_INDEX:"(index)"},w="source",v=new Set(["datetimeIndex","float_64Index","int_64Index","rangeIndex","timedeltaIndex","uint_64Index"]);class b extends a.PureComponent{constructor(){super(...arguments),this.vegaView=void 0,this.vegaFinalizer=void 0,this.defaultDataName=w,this.element=null,this.state={error:void 0},this.finalizeView=()=>{this.vegaFinalizer&&this.vegaFinalizer(),this.vegaFinalizer=void 0,this.vegaView=void 0},this.generateSpec=()=>{const{element:t,theme:e}=this.props,i=JSON.parse(t.get("spec")),a=JSON.parse(t.get("useContainerWidth"));if(i.config=function(t,e){const{colors:i,fontSizes:a,genericFonts:n}=e,s={labelFont:n.bodyFont,titleFont:n.bodyFont,labelFontSize:a.twoSmPx,titleFontSize:a.twoSmPx},o={background:i.bgColor,axis:{labelColor:i.bodyText,titleColor:i.bodyText,gridColor:i.fadedText10,...s},legend:{labelColor:i.bodyText,titleColor:i.bodyText,...s},title:{color:i.bodyText,subtitleColor:i.bodyText,...s},header:{labelColor:i.bodyText},view:{continuousHeight:300,continuousWidth:400}};if(!t)return o;return r()({},o,t)}(i.config,e),this.props.height?(i.width=this.props.width-38,i.height=this.props.height):a&&(i.width=this.props.width-38),i.padding||(i.padding={}),null==i.padding.bottom&&(i.padding.bottom=20),i.datasets)throw new Error("Datasets should not be passed as part of the spec");return i}}async componentDidMount(){try{await this.createView()}catch(t){const e=(0,g.b)(t);this.setState({error:e})}}componentWillUnmount(){this.finalizeView()}async componentDidUpdate(t){const{element:e,theme:i}=t,{element:a,theme:n}=this.props,s=e.get("spec"),r=a.get("spec");if(!this.vegaView||s!==r||i!==n||t.width!==this.props.width||t.height!==this.props.height){(0,l.ji)("Vega spec changed.");try{await this.createView()}catch(u){const t=(0,g.b)(u);this.setState({error:t})}return}const o=e.get("data"),h=a.get("data");(o||h)&&this.updateData(this.defaultDataName,o,h);const d=y(e)||{},c=y(a)||{};for(const[l,g]of Object.entries(c)){const t=l||this.defaultDataName,e=d[t];this.updateData(t,e,g)}for(const l of Object.keys(d))c.hasOwnProperty(l)||l===this.defaultDataName||this.updateData(l,null,null);this.vegaView.resize().runAsync()}updateData(t,e,i){if(!this.vegaView)throw new Error("Chart has not been drawn yet");if(!i||!i.get("data")){return void(this.vegaView._runtime.data.hasOwnProperty(t)&&this.vegaView.remove(t,o.truthy))}if(!e||!e.get("data"))return void this.vegaView.insert(t,x(i));const[a,n]=(0,u.oo)(e.get("data")),[s,r]=(0,u.oo)(i.get("data"));if(function(t,e,i,a,n,s){if(i!==s)return!1;if(e>=n)return!1;if(0===e)return!1;const r=t.get("data"),o=a.get("data"),h=s-1,d=e-1;if((0,u.Fm)(r,h,0)!==(0,u.Fm)(o,h,0)||(0,u.Fm)(r,h,d)!==(0,u.Fm)(o,h,d))return!1;return!0}(e,a,n,i,s,r))a<s&&this.vegaView.insert(t,x(i,a));else{const e=o.changeset().remove(o.truthy).insert(x(i));this.vegaView.change(t,e),(0,l.ji)("Had to clear the ".concat(t," dataset before inserting data through Vega view."))}}async createView(){if((0,l.ji)("Creating a new Vega view."),!this.element)throw Error("Element missing.");this.finalizeView();const t=this.props.element,e=this.generateSpec(),i={ast:!0,expr:d.N,tooltip:{disableDefaultStyle:!0},defaultStyle:""},{vgSpec:a,view:n,finalize:s}=await(0,h.ZP)(this.element,e,i);this.vegaView=n,this.vegaFinalizer=s;const r=function(t){const e=y(t);if(null==e)return null;const i={};for(const[a,n]of Object.entries(e))i[a]=x(n);return i}(t),o=r?Object.keys(r):[];if(1===o.length){const[t]=o;this.defaultDataName=t}else 0===o.length&&a.data&&(this.defaultDataName=w);const c=function(t){const e=t.get("data");if(!e)return null;return x(e)}(t);if(c&&n.insert(this.defaultDataName,c),r)for(const[h,d]of Object.entries(r))n.insert(h,d);await n.runAsync(),this.vegaView.resize().runAsync()}render(){if(this.state.error)throw this.state.error;return(0,p.jsx)(f,{"data-testid":"stVegaLiteChart",ref:t=>{this.element=t}})}}function y(t){if(!t.get("datasets")||t.get("datasets").isEmpty())return null;const e={};return t.get("datasets").forEach((t=>{if(!t)return;const i=t.get("hasName")?t.get("name"):null;e[i]=t.get("data")})),e}function x(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t.get("data"))return[];if(!t.get("index"))return[];if(!t.get("columns"))return[];const i=[],[a,n]=(0,u.oo)(t.get("data")),s=t.get("index").get("type"),r=v.has(s);for(let o=e;o<a;o++){const e={};r&&(e[m.DATAFRAME_INDEX]=(0,u.l$)(t.get("index"),0,o));for(let i=0;i<n;i++)e[(0,u.l$)(t.get("columns"),0,i)]=(0,u.Fm)(t.get("data"),i,o);i.push(e)}return i}const V=(0,n.b)((0,c.Z)(b))},43875:()=>{},82624:()=>{}}]);
//# sourceMappingURL=5724.dd69f628.chunk.js.map