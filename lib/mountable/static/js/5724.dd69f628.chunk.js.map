{"version":3,"file":"static/js/5724.dd69f628.chunk.js","mappings":"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","sources":["../../../streamlit/frontend/lib/src/components/elements/VegaLiteChart/styled-components.ts","../../../streamlit/frontend/lib/src/components/elements/VegaLiteChart/VegaLiteChart.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport styled from \"@emotion/styled\"\n\nexport const StyledVegaLiteChartContainer = styled.div(({ theme }) => ({\n  // These styles come from VegaLite Library\n  \"&.vega-embed\": {\n    \".vega-actions\": {\n      zIndex: theme.zIndices.popupMenu,\n    },\n    summary: {\n      // Fix weird floating button height issue in Vega Lite.\n      height: \"auto\",\n      // Fix floating button appearing above pop-ups.\n      zIndex: theme.zIndices.menuButton,\n    },\n  },\n}))\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { PureComponent } from \"react\"\nimport { withTheme } from \"@emotion/react\"\nimport { Map as ImmutableMap } from \"immutable\"\nimport merge from \"lodash/merge\"\nimport * as vega from \"vega\"\nimport embed from \"vega-embed\"\nimport { expressionInterpreter } from \"vega-interpreter\"\n\nimport { logMessage } from \"@streamlit/lib/src/util/log\"\nimport withFullScreenWrapper from \"@streamlit/lib/src/hocs/withFullScreenWrapper\"\nimport {\n  tableGetRowsAndCols,\n  indexGet,\n  tableGet,\n} from \"@streamlit/lib/src/dataframes/dataFrameProto\"\nimport { ensureError } from \"@streamlit/lib/src/util/ErrorHandling\"\nimport { EmotionTheme } from \"@streamlit/lib/src/theme\"\n\nimport \"@streamlit/lib/src/assets/css/vega-embed.css\"\nimport \"@streamlit/lib/src/assets/css/vega-tooltip.css\"\n\nimport { StyledVegaLiteChartContainer } from \"./styled-components\"\n\nconst MagicFields = {\n  DATAFRAME_INDEX: \"(index)\",\n}\n\nconst DEFAULT_DATA_NAME = \"source\"\n\n/**\n * Horizontal space needed for the embed actions button.\n */\nconst EMBED_PADDING = 38\n\n/**\n * Fix bug where Vega Lite was vertically-cropping the x-axis in some cases.\n * For example, in e2e/scripts/add_rows.py\n */\nconst BOTTOM_PADDING = 20\n\n/** Types of dataframe-indices that are supported as x axes. */\nconst SUPPORTED_INDEX_TYPES = new Set([\n  \"datetimeIndex\",\n  \"float_64Index\",\n  \"int_64Index\",\n  \"rangeIndex\",\n  \"timedeltaIndex\",\n  \"uint_64Index\",\n])\n\ninterface Props {\n  width: number\n  element: ImmutableMap<string, any>\n  theme: EmotionTheme\n}\n\nexport interface PropsWithHeight extends Props {\n  height?: number\n}\n\ninterface State {\n  error?: Error\n}\n\nexport class VegaLiteChart extends PureComponent<PropsWithHeight, State> {\n  /**\n   * The Vega view object\n   */\n  private vegaView?: vega.View\n\n  /**\n   * Finalizer for the embedded vega object. Must be called to dispose\n   * of the vegaView when it's no longer used.\n   */\n  private vegaFinalizer?: () => void\n\n  /**\n   * The default data name to add to.\n   */\n  private defaultDataName = DEFAULT_DATA_NAME\n\n  /**\n   * The html element we attach the Vega view to.\n   */\n  private element: HTMLDivElement | null = null\n\n  readonly state = {\n    error: undefined,\n  }\n\n  public async componentDidMount(): Promise<void> {\n    try {\n      await this.createView()\n    } catch (e) {\n      const error = ensureError(e)\n      this.setState({ error })\n    }\n  }\n\n  public componentWillUnmount(): void {\n    this.finalizeView()\n  }\n\n  /**\n   * Finalize the view so it can be garbage collected. This should be done\n   * when a new view is created, and when the component unmounts.\n   */\n  private finalizeView = (): any => {\n    if (this.vegaFinalizer) {\n      this.vegaFinalizer()\n    }\n    this.vegaFinalizer = undefined\n    this.vegaView = undefined\n  }\n\n  public async componentDidUpdate(prevProps: PropsWithHeight): Promise<void> {\n    const { element: prevElement, theme: prevTheme } = prevProps\n    const { element, theme } = this.props\n\n    const prevSpec = prevElement.get(\"spec\")\n    const spec = element.get(\"spec\")\n\n    if (\n      !this.vegaView ||\n      prevSpec !== spec ||\n      prevTheme !== theme ||\n      prevProps.width !== this.props.width ||\n      prevProps.height !== this.props.height\n    ) {\n      logMessage(\"Vega spec changed.\")\n      try {\n        await this.createView()\n      } catch (e) {\n        const error = ensureError(e)\n\n        this.setState({ error })\n      }\n      return\n    }\n\n    const prevData = prevElement.get(\"data\")\n    const data = element.get(\"data\")\n\n    if (prevData || data) {\n      this.updateData(this.defaultDataName, prevData, data)\n    }\n\n    const prevDataSets = getDataSets(prevElement) || {}\n    const dataSets = getDataSets(element) || {}\n\n    for (const [name, dataset] of Object.entries(dataSets)) {\n      const datasetName = name || this.defaultDataName\n      const prevDataset = prevDataSets[datasetName]\n      this.updateData(datasetName, prevDataset, dataset)\n    }\n\n    // Remove all datasets that are in the previous but not the current datasets.\n    for (const name of Object.keys(prevDataSets)) {\n      if (!dataSets.hasOwnProperty(name) && name !== this.defaultDataName) {\n        this.updateData(name, null, null)\n      }\n    }\n\n    this.vegaView.resize().runAsync()\n  }\n\n  public generateSpec = (): any => {\n    const { element: el, theme } = this.props\n    const spec = JSON.parse(el.get(\"spec\"))\n    const useContainerWidth = JSON.parse(el.get(\"useContainerWidth\"))\n\n    spec.config = configWithThemeDefaults(spec.config, theme)\n\n    if (this.props.height) {\n      // fullscreen\n      spec.width = this.props.width - EMBED_PADDING\n      spec.height = this.props.height\n    } else if (useContainerWidth) {\n      spec.width = this.props.width - EMBED_PADDING\n    }\n\n    if (!spec.padding) {\n      spec.padding = {}\n    }\n\n    if (spec.padding.bottom == null) {\n      spec.padding.bottom = BOTTOM_PADDING\n    }\n\n    if (spec.datasets) {\n      throw new Error(\"Datasets should not be passed as part of the spec\")\n    }\n\n    return spec\n  }\n\n  /**\n   * Update the dataset in the Vega view. This method tried to minimize changes\n   * by automatically creating and applying diffs.\n   *\n   * @param name The name of the dataset.\n   * @param prevData The dataset before the update.\n   * @param data The dataset at the current state.\n   */\n  private updateData(\n    name: string,\n    prevData: ImmutableMap<string, any> | null,\n    data: ImmutableMap<string, any> | null\n  ): void {\n    if (!this.vegaView) {\n      throw new Error(\"Chart has not been drawn yet\")\n    }\n\n    if (!data || !data.get(\"data\")) {\n      const view = this.vegaView as any\n      // eslint-disable-next-line no-underscore-dangle\n      const viewHasDataWithName = view._runtime.data.hasOwnProperty(name)\n      if (viewHasDataWithName) {\n        this.vegaView.remove(name, vega.truthy)\n      }\n      return\n    }\n\n    if (!prevData || !prevData.get(\"data\")) {\n      this.vegaView.insert(name, getDataArray(data))\n      return\n    }\n\n    const [prevNumRows, prevNumCols] = tableGetRowsAndCols(\n      prevData.get(\"data\")\n    )\n    const [numRows, numCols] = tableGetRowsAndCols(data.get(\"data\"))\n\n    // Check if dataframes have same \"shape\" but the new one has more rows.\n    if (\n      dataIsAnAppendOfPrev(\n        prevData,\n        prevNumRows,\n        prevNumCols,\n        data,\n        numRows,\n        numCols\n      )\n    ) {\n      if (prevNumRows < numRows) {\n        this.vegaView.insert(name, getDataArray(data, prevNumRows))\n      }\n    } else {\n      // Clean the dataset and insert from scratch.\n      const cs = vega\n        .changeset()\n        .remove(vega.truthy)\n        .insert(getDataArray(data))\n      this.vegaView.change(name, cs)\n      logMessage(\n        `Had to clear the ${name} dataset before inserting data through Vega view.`\n      )\n    }\n  }\n\n  /**\n   * Create a new Vega view and add the data.\n   */\n  private async createView(): Promise<void> {\n    logMessage(\"Creating a new Vega view.\")\n\n    if (!this.element) {\n      throw Error(\"Element missing.\")\n    }\n\n    // Finalize the previous view so it can be garbage collected.\n    this.finalizeView()\n\n    const el = this.props.element\n    const spec = this.generateSpec()\n    const options = {\n      // Adds interpreter support for Vega expressions that is compliant with CSP\n      ast: true,\n      expr: expressionInterpreter,\n\n      // Disable default styles so that vega doesn't inject <style> tags in the\n      // DOM. We set these styles manually for finer control over them and to\n      // avoid inlining styles.\n      tooltip: { disableDefaultStyle: true },\n      // NOTE: We pass the empty string to the `defaultStyle` field here\n      // because setting it to false causes vega-embed to omit menu options on\n      // the chart entirely, which we don't want. Setting `defaultStyle` to the\n      // empty string causes vega-embed to inject an empty <style /> tag into\n      // the DOM, which may be harmlessly blocked by a CSP. This is fine as\n      // we're providing our own styles for vega components. While this works\n      // for now, we'll be submitting an upstream PR to vega-embed to make\n      // things less hacky.\n      defaultStyle: \"\",\n    }\n\n    const { vgSpec, view, finalize } = await embed(this.element, spec, options)\n\n    this.vegaView = view\n    this.vegaFinalizer = finalize\n\n    const datasets = getDataArrays(el)\n\n    // Heuristic to determine the default dataset name.\n    const datasetNames = datasets ? Object.keys(datasets) : []\n    if (datasetNames.length === 1) {\n      const [datasetName] = datasetNames\n      this.defaultDataName = datasetName\n    } else if (datasetNames.length === 0 && vgSpec.data) {\n      this.defaultDataName = DEFAULT_DATA_NAME\n    }\n\n    const dataObj = getInlineData(el)\n    if (dataObj) {\n      view.insert(this.defaultDataName, dataObj)\n    }\n    if (datasets) {\n      for (const [name, data] of Object.entries(datasets)) {\n        view.insert(name, data)\n      }\n    }\n\n    await view.runAsync()\n\n    // Fix bug where the \"...\" menu button overlaps with charts where width is\n    // set to -1 on first load.\n    this.vegaView.resize().runAsync()\n  }\n\n  public render(): JSX.Element {\n    if (this.state.error) {\n      // eslint-disable-next-line @typescript-eslint/no-throw-literal\n      throw this.state.error\n    }\n\n    return (\n      // Create the container Vega draws inside.\n      <StyledVegaLiteChartContainer\n        data-testid=\"stVegaLiteChart\"\n        ref={c => {\n          this.element = c\n        }}\n      />\n    )\n  }\n}\n\nfunction getInlineData(\n  el: ImmutableMap<string, any>\n): { [field: string]: any }[] | null {\n  const dataProto = el.get(\"data\")\n\n  if (!dataProto) {\n    return null\n  }\n\n  return getDataArray(dataProto)\n}\n\nfunction getDataArrays(\n  el: ImmutableMap<string, any>\n): { [dataset: string]: any[] } | null {\n  const datasets = getDataSets(el)\n\n  if (datasets == null) {\n    return null\n  }\n\n  const datasetArrays: { [dataset: string]: any[] } = {}\n\n  for (const [name, dataset] of Object.entries(datasets)) {\n    datasetArrays[name] = getDataArray(dataset)\n  }\n\n  return datasetArrays\n}\n\nfunction getDataSets(\n  el: ImmutableMap<string, any>\n): { [dataset: string]: ImmutableMap<string, any> } | null {\n  if (!el.get(\"datasets\") || el.get(\"datasets\").isEmpty()) {\n    return null\n  }\n\n  const datasets: { [dataset: string]: any } = {}\n\n  el.get(\"datasets\").forEach((x: any) => {\n    if (!x) {\n      return\n    }\n    const name = x.get(\"hasName\") ? x.get(\"name\") : null\n    datasets[name] = x.get(\"data\")\n  })\n\n  return datasets\n}\n\nfunction getDataArray(\n  dataProto: ImmutableMap<string, any>,\n  startIndex = 0\n): { [field: string]: any }[] {\n  if (!dataProto.get(\"data\")) {\n    return []\n  }\n  if (!dataProto.get(\"index\")) {\n    return []\n  }\n  if (!dataProto.get(\"columns\")) {\n    return []\n  }\n\n  const dataArr = []\n  const [rows, cols] = tableGetRowsAndCols(dataProto.get(\"data\"))\n\n  const indexType = dataProto.get(\"index\").get(\"type\")\n  const hasSupportedIndex = SUPPORTED_INDEX_TYPES.has(indexType)\n\n  for (let rowIndex = startIndex; rowIndex < rows; rowIndex++) {\n    const row: { [field: string]: any } = {}\n\n    if (hasSupportedIndex) {\n      row[MagicFields.DATAFRAME_INDEX] = indexGet(\n        dataProto.get(\"index\"),\n        0,\n        rowIndex\n      )\n    }\n\n    for (let colIndex = 0; colIndex < cols; colIndex++) {\n      row[indexGet(dataProto.get(\"columns\"), 0, colIndex)] = tableGet(\n        dataProto.get(\"data\"),\n        colIndex,\n        rowIndex\n      )\n    }\n\n    dataArr.push(row)\n  }\n\n  return dataArr\n}\n\n/**\n * Checks if data looks like it's just prevData plus some appended rows.\n */\nexport function dataIsAnAppendOfPrev(\n  prevData: ImmutableMap<string, number>,\n  prevNumRows: number,\n  prevNumCols: number,\n  data: ImmutableMap<string, number>,\n  numRows: number,\n  numCols: number\n): boolean {\n  // Check whether dataframes have the same shape.\n\n  // not an append\n  if (prevNumCols !== numCols) {\n    return false\n  }\n\n  // Data can be updated, but still have the same number of rows.\n  // We consider the case an append only when the number of rows has increased\n  if (prevNumRows >= numRows) {\n    return false\n  }\n\n  // if no previous data, render from scratch\n  if (prevNumRows === 0) {\n    return false\n  }\n\n  const df0 = prevData.get(\"data\")\n  const df1 = data.get(\"data\")\n  const c = numCols - 1\n  const r = prevNumRows - 1\n\n  // Check if the new dataframe looks like it's a superset of the old one.\n  // (this is a very light check, and not guaranteed to be right!)\n  if (\n    tableGet(df0, c, 0) !== tableGet(df1, c, 0) ||\n    tableGet(df0, c, r) !== tableGet(df1, c, r)\n  ) {\n    return false\n  }\n\n  return true\n}\n\nfunction configWithThemeDefaults(config: any, theme: EmotionTheme): any {\n  const { colors, fontSizes, genericFonts } = theme\n  const themeFonts = {\n    labelFont: genericFonts.bodyFont,\n    titleFont: genericFonts.bodyFont,\n    labelFontSize: fontSizes.twoSmPx,\n    titleFontSize: fontSizes.twoSmPx,\n  }\n  const themeDefaults = {\n    background: colors.bgColor,\n    axis: {\n      labelColor: colors.bodyText,\n      titleColor: colors.bodyText,\n      gridColor: colors.fadedText10,\n      ...themeFonts,\n    },\n    legend: {\n      labelColor: colors.bodyText,\n      titleColor: colors.bodyText,\n      ...themeFonts,\n    },\n    title: {\n      color: colors.bodyText,\n      subtitleColor: colors.bodyText,\n      ...themeFonts,\n    },\n    header: {\n      labelColor: colors.bodyText,\n    },\n    view: {\n      continuousHeight: 300,\n      continuousWidth: 400,\n    },\n  }\n\n  if (!config) {\n    return themeDefaults\n  }\n\n  // Fill in theme defaults where the user didn't specify config options.\n  return merge({}, themeDefaults, config)\n}\n\nexport default withTheme(withFullScreenWrapper(VegaLiteChart))\n"],"names":["StyledVegaLiteChartContainer","_styled","target","_ref","theme","zIndex","zIndices","popupMenu","summary","height","menuButton","MagicFields","DATAFRAME_INDEX","DEFAULT_DATA_NAME","SUPPORTED_INDEX_TYPES","Set","VegaLiteChart","PureComponent","constructor","arguments","vegaView","vegaFinalizer","defaultDataName","element","state","error","undefined","finalizeView","this","generateSpec","el","props","spec","JSON","parse","get","useContainerWidth","config","colors","fontSizes","genericFonts","themeFonts","labelFont","bodyFont","titleFont","labelFontSize","twoSmPx","titleFontSize","themeDefaults","background","bgColor","axis","labelColor","bodyText","titleColor","gridColor","fadedText10","legend","title","color","subtitleColor","header","view","continuousHeight","continuousWidth","merge","configWithThemeDefaults","width","padding","bottom","datasets","Error","componentDidMount","createView","e","ensureError","setState","componentWillUnmount","componentDidUpdate","prevProps","prevElement","prevTheme","prevSpec","logMessage","prevData","data","updateData","prevDataSets","getDataSets","dataSets","name","dataset","Object","entries","datasetName","prevDataset","keys","hasOwnProperty","resize","runAsync","_runtime","remove","vega","insert","getDataArray","prevNumRows","prevNumCols","tableGetRowsAndCols","numRows","numCols","df0","df1","c","r","tableGet","dataIsAnAppendOfPrev","cs","change","concat","options","ast","expr","expressionInterpreter","tooltip","disableDefaultStyle","defaultStyle","vgSpec","finalize","embed","datasetArrays","getDataArrays","datasetNames","length","dataObj","dataProto","getInlineData","render","_jsx","ref","isEmpty","forEach","x","startIndex","dataArr","rows","cols","indexType","hasSupportedIndex","has","rowIndex","row","indexGet","colIndex","push","withTheme","withFullScreenWrapper"],"sourceRoot":""}