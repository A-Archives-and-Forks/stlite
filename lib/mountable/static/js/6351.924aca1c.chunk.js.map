{"version":3,"file":"static/js/6351.924aca1c.chunk.js","mappings":"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","sources":["../../../streamlit/frontend/src/components/widgets/DataFrame/EditingState.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/hooks/useCustomTheme.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/utils.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/ObjectColumn.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/TextColumn.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/BooleanColumn.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/CategoricalColumn.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/ListColumn.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/NumberColumn.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/columns/index.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/arrowUtils.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/hooks/useDataLoader.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/hooks/useTableSizer.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/hooks/useDataEditor.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/hooks/useColumnSizer.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/hooks/useColumnSort.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/styled-components.ts","../../../streamlit/frontend/src/components/widgets/DataFrame/DataFrame.tsx"],"sourcesContent":["/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell } from \"@glideapps/glide-data-grid\"\n\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\n\nimport { BaseColumn } from \"./columns\"\n\n/**\n * The editing state keeps track of all table edits applied by the user.\n */\nclass EditingState {\n  // row -> column -> GridCell\n  // Using [number, number] as a key for a Map would not work.\n  private editedCells: Map<number, Map<number, GridCell>> = new Map()\n\n  // List of rows represented by of column -> GridCell mappings\n  private addedRows: Array<Map<number, GridCell>> = []\n\n  // List of deleted row IDs\n  private deletedRows: number[] = []\n\n  // The original number of rows in the table (without potential additions & deletions)\n  private numRows = 0\n\n  constructor(numRows: number) {\n    this.numRows = numRows\n  }\n\n  /**\n   * Convert the current editing state to a JSON string.\n   *\n   * @param columns - The columns of the table\n   * @returns JSON string\n   */\n  toJson(columns: BaseColumn[]): string {\n    const columnsByIndex = new Map<number, BaseColumn>()\n    columns.forEach(column => {\n      columnsByIndex.set(column.indexNumber, column)\n    })\n\n    const currentState = {\n      // We use snake case here since this is the widget state\n      // that is sent and used in the backend. Therefore, it should\n      // conform with the Python naming conventions.\n      edited_cells: {} as Record<string, any>,\n      added_rows: [] as Record<number, any>[],\n      deleted_rows: [] as number[],\n    }\n\n    // Loop through all edited cells and transform into the structure\n    // we use for the JSON-compatible widget state:\n    // \"<rowIndex>:<colIndex>` -> edited value\n    this.editedCells.forEach(\n      (row: Map<number, GridCell>, rowIndex: number, _map) => {\n        row.forEach((cell: GridCell, colIndex: number, _map) => {\n          const column = columnsByIndex.get(colIndex)\n          if (column) {\n            currentState.edited_cells[`${rowIndex}:${colIndex}`] =\n              column.getCellValue(cell)\n          }\n        })\n      }\n    )\n\n    // Loop through all added rows and transform into the format that\n    // we use for the JSON-compatible widget state:\n    // List of column index -> edited value\n    this.addedRows.forEach((row: Map<number, GridCell>) => {\n      const addedRow: Record<number, any> = {}\n      row.forEach((cell: GridCell, colIndex: number, _map) => {\n        const column = columnsByIndex.get(colIndex)\n        if (column) {\n          const cellValue = column.getCellValue(cell)\n          if (notNullOrUndefined(cellValue)) {\n            addedRow[colIndex] = cellValue\n          }\n        }\n      })\n      currentState.added_rows.push(addedRow)\n    })\n\n    // The deleted rows don't need to be transformed\n    currentState.deleted_rows = this.deletedRows\n\n    // Convert undefined values to null, otherwise this is removed here since\n    // undefined does not exist in JSON.\n    const json = JSON.stringify(currentState, (k, v) =>\n      v === undefined ? null : v\n    )\n    return json\n  }\n\n  /**\n   * Returns true if the given row was added by the user through the UI.\n   */\n  isAddedRow(row: number): boolean {\n    return row >= this.numRows\n  }\n\n  /**\n   * Returns the cell at the given column and row,\n   * in case the cell was edited or added.\n   *\n   * @param col - The column index\n   * @param row - The row index\n   *\n   * @returns The edited cell at the given column and row\n   */\n  getCell(col: number, row: number): GridCell | undefined {\n    if (this.isAddedRow(row)) {\n      // Added rows have their own editing state\n      return this.addedRows[row - this.numRows].get(col)\n    }\n\n    const rowCache = this.editedCells.get(row)\n    if (rowCache === undefined) {\n      return undefined\n    }\n\n    return rowCache.get(col)\n  }\n\n  /**\n   * Adds a cell to the editing state for the given column and row index.\n   *\n   * @param col - The column index\n   * @param row - The row index\n   * @param cell - The cell to add to the editing state\n   */\n  setCell(col: number, row: number, cell: GridCell): void {\n    if (this.isAddedRow(row)) {\n      if (row - this.numRows >= this.addedRows.length) {\n        // Added row does not exist. This is only expected to happen\n        // in relation to a trailing row issue in glide-data-grid.\n        return\n      }\n      // Added rows have their own editing state\n      this.addedRows[row - this.numRows].set(col, cell)\n    } else {\n      if (this.editedCells.get(row) === undefined) {\n        this.editedCells.set(row, new Map())\n      }\n\n      const rowCache = this.editedCells.get(row) as Map<number, GridCell>\n      rowCache.set(col, cell)\n    }\n  }\n\n  /**\n   * Adds a new row to the editing state.\n   *\n   * @param rowCells - The cells of the row to add\n   */\n  addRow(rowCells: Map<number, GridCell>): void {\n    this.addedRows.push(rowCells)\n  }\n\n  /**\n   * Deletes the given rows from the editing state.\n   *\n   * @param rows - The rows to delete\n   */\n  deleteRows(rows: number[]): void {\n    // Delete row one by one starting from the row with the highest index\n    rows\n      .sort((a, b) => b - a)\n      .forEach(row => {\n        this.deleteRow(row)\n      })\n  }\n\n  /**\n   * Deletes the given row from the editing state.\n   *\n   * @param row - The row to delete\n   */\n  deleteRow(row: number): void {\n    if (isNullOrUndefined(row) || row < 0) {\n      // This should never happen\n      return\n    }\n\n    if (this.isAddedRow(row)) {\n      // Remove from added rows:\n      this.addedRows.splice(row - this.numRows, 1)\n      // there is nothing more we have to do\n      return\n    }\n\n    if (!this.deletedRows.includes(row)) {\n      // Add to the set\n      this.deletedRows.push(row)\n      // Sort the deleted rows (important for calculation of the original row index)\n      this.deletedRows = this.deletedRows.sort((a, b) => a - b)\n    }\n\n    // Remove all cells from cell state associated with this row:\n    this.editedCells.delete(row)\n  }\n\n  /**\n   * Returns the original row index of the given row.\n   * Since the user can delete rows, the original row index and the\n   * current one can diverge.\n   *\n   * @param row - The row index from the current state\n   *\n   * @returns The original row index\n   */\n  getOriginalRowIndex(row: number): number {\n    // Just count all deleted rows before this row to determine the original row index:\n    let originalIndex = row\n    for (let i = 0; i < this.deletedRows.length; i++) {\n      if (this.deletedRows[i] > originalIndex) {\n        break\n      }\n      originalIndex += 1\n    }\n    return originalIndex\n  }\n\n  /**\n   * Returns the total number of rows of the current state.\n   */\n  getNumRows(): number {\n    return this.numRows + this.addedRows.length - this.deletedRows.length\n  }\n}\n\nexport default EditingState\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { transparentize } from \"color2k\"\nimport { Theme as GlideTheme } from \"@glideapps/glide-data-grid\"\nimport { useTheme } from \"@emotion/react\"\n\nimport { Theme } from \"src/theme\"\n\n/**\n * Creates a glide-data-grid compatible theme based on our theme configuration.\n *\n * @return a glide-data-grid compatible theme.\n */\nfunction useCustomTheme(): Partial<GlideTheme> & {\n  tableBorderRadius: string\n} {\n  const theme: Theme = useTheme()\n\n  return {\n    // Explanations: https://github.com/glideapps/glide-data-grid/blob/main/packages/core/API.md#theme\n    accentColor: theme.colors.primary,\n    accentFg: theme.colors.white,\n    accentLight: transparentize(theme.colors.primary, 0.9),\n    borderColor: theme.colors.fadedText05,\n    horizontalBorderColor: theme.colors.fadedText05,\n    fontFamily: theme.genericFonts.bodyFont,\n    bgSearchResult: transparentize(theme.colors.primary, 0.9),\n    // Header styling:\n    bgIconHeader: theme.colors.fadedText60,\n    fgIconHeader: theme.colors.white,\n    bgHeader: theme.colors.bgMix,\n    bgHeaderHasFocus: theme.colors.secondaryBg,\n    bgHeaderHovered: theme.colors.bgMix, // uses same color as bgHeader to deactivate the hover effect\n    textHeader: theme.colors.fadedText60,\n    textHeaderSelected: theme.colors.white,\n    textGroupHeader: theme.colors.fadedText60,\n    headerFontStyle: `${theme.fontSizes.sm}`,\n    // Cell styling:\n    baseFontStyle: theme.fontSizes.sm,\n    editorFontSize: theme.fontSizes.sm,\n    textDark: theme.colors.bodyText,\n    textMedium: transparentize(theme.colors.bodyText, 0.2),\n    textLight: theme.colors.fadedText40,\n    textBubble: theme.colors.fadedText60,\n    bgCell: theme.colors.bgColor,\n    bgCellMedium: theme.colors.bgColor, // uses same as bgCell to always have the same background color\n    cellHorizontalPadding: 8,\n    cellVerticalPadding: 3,\n    // Special cells:\n    bgBubble: theme.colors.secondaryBg,\n    bgBubbleSelected: theme.colors.secondaryBg,\n    linkColor: theme.colors.linkText,\n    drilldownBorder: theme.colors.darkenedBgMix25,\n    // Unused settings:\n    // lineHeight\n    // Custom settings\n    tableBorderRadius: theme.radii.md,\n  }\n}\n\nexport default useCustomTheme\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GridCell,\n  Theme as GlideTheme,\n  TextCell,\n  GridCellKind,\n  LoadingCell,\n  GridColumn,\n} from \"@glideapps/glide-data-grid\"\nimport { toString, merge, isArray } from \"lodash\"\nimport numbro from \"numbro\"\n\nimport { Type as ArrowType } from \"src/lib/Quiver\"\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\n\n/**\n * Interface used for defining the properties (configuration options) of a column.\n * These options can also be used to overwrite from user-defined column config.\n */\nexport interface BaseColumnProps {\n  // The id of the column:\n  readonly id: string\n  // The title of the column:\n  readonly title: string\n  // The index number of the column:\n  readonly indexNumber: number\n  // The arrow data type of the column:\n  readonly arrowType: ArrowType\n  // If `True`, the column can be edited:\n  readonly isEditable: boolean\n  // If `True`, the column is hidden (will not be shown):\n  readonly isHidden: boolean\n  // If `True`, the column is a table index:\n  readonly isIndex: boolean\n  // If `True`, the column is a stretched:\n  readonly isStretched: boolean\n  // The initial width of the column:\n  readonly width?: number\n  // Column type selected via column config:\n  readonly customType?: string\n  // Additional metadata related to the column type:\n  readonly columnTypeMetadata?: Record<string, any>\n  // The content alignment of the column:\n  readonly contentAlignment?: \"left\" | \"center\" | \"right\"\n  // Theme overrides for this column:\n  readonly themeOverride?: Partial<GlideTheme>\n}\n\n/**\n * The interface that is implemented by any column type.\n */\nexport interface BaseColumn extends BaseColumnProps {\n  readonly kind: string\n  // Defines the sort mode that should be used for this column type:\n  // default: Sorts by interpreting all values as strings.\n  // smart: Detects if value is a number or a string and sorts accordingly.\n  // raw: Sorts based on the actual type of the cell data value.\n  readonly sortMode: \"default\" | \"raw\" | \"smart\"\n  // Get a cell with the provided data for the column type:\n  getCell(data?: any): GridCell\n  // Get the raw cell of a provided cell:\n  getCellValue(cell: GridCell): any | null\n}\n\n/**\n * A type that describes the function signature used to create a column based on\n * some column properties.\n */\nexport type ColumnCreator = {\n  (props: BaseColumnProps): BaseColumn\n  readonly isEditableType: boolean\n}\n\n/**\n * Interface used for indicating if a cell contains an error.\n */\ninterface ErrorCell extends TextCell {\n  readonly isError: true\n}\n\n/**\n * Returns a cell with an error message.\n *\n * @param errorMsg: A short error message to use as display value.\n * @param errorDetails: The full error message to show when the user\n *                     clicks on a cell.\n *\n * @return a read-only GridCell object that can be used by glide-data-grid.\n */\nexport function getErrorCell(errorMsg: string, errorDetails = \"\"): ErrorCell {\n  errorMsg = `⚠️ ${errorMsg}`\n  return {\n    kind: GridCellKind.Text,\n    readonly: true,\n    allowOverlay: true,\n    data: errorMsg + (errorDetails ? `\\n\\n${errorDetails}\\n` : \"\"),\n    displayData: errorMsg,\n    isError: true,\n  } as ErrorCell\n}\n\n/**\n * Returns `true` if the given cell contains an error.\n * This can happen if the value type is not compatible with\n * the given value type.\n */\nexport function isErrorCell(cell: GridCell): cell is ErrorCell {\n  return cell.hasOwnProperty(\"isError\") && (cell as ErrorCell).isError\n}\n\n/**\n * Interface used for indicating if a cell contains no value.\n */\ninterface MissingValueCell extends TextCell {\n  readonly isMissingValue: true\n}\n\n/**\n * Returns `true` if the given cell contains no value (-> missing value).\n * For example, a number cell that contains null is interpreted as a missing value.\n */\nexport function isMissingValueCell(cell: GridCell): cell is MissingValueCell {\n  return (\n    cell.hasOwnProperty(\"isMissingValue\") &&\n    (cell as MissingValueCell).isMissingValue\n  )\n}\n\n/**\n * Returns an empty cell.\n */\nexport function getEmptyCell(): LoadingCell {\n  return {\n    kind: GridCellKind.Loading,\n    allowOverlay: false,\n  } as LoadingCell\n}\n\n/**\n * Returns an empty text cell.\n *\n * @param readonly: If true, returns a read-only version of the cell.\n * @param faded: If true, returns a faded version of the cell.\n *\n * @return a GridCell object that can be used by glide-data-grid.\n */\nexport function getTextCell(readonly: boolean, faded: boolean): TextCell {\n  const style = faded ? \"faded\" : \"normal\"\n  return {\n    kind: GridCellKind.Text,\n    data: \"\",\n    displayData: \"\",\n    allowOverlay: true,\n    readonly,\n    style,\n  } as TextCell\n}\n\n/**\n * Converts from our BaseColumn format to the glide-data-grid compatible GridColumn.\n */\nexport function toGlideColumn(column: BaseColumn): GridColumn {\n  return {\n    id: column.id,\n    title: column.title,\n    hasMenu: false,\n    themeOverride: column.themeOverride,\n    ...(column.isStretched && {\n      grow: column.isIndex ? 1 : 3,\n    }),\n    ...(column.width && {\n      width: column.width,\n    }),\n  } as GridColumn\n}\n\n/**\n * Merges the default column parameters with the user-defined column parameters.\n *\n * @param defaultParams - The default column parameters.\n * @param userParams - The user-defined column parameters.\n *\n * @returns The merged column parameters.\n */\nexport function mergeColumnParameters(\n  defaultParams: Record<string, any> | undefined | null,\n  userParams: Record<string, any> | undefined | null\n): Record<string, any> {\n  if (isNullOrUndefined(defaultParams)) {\n    return userParams || {}\n  }\n\n  if (isNullOrUndefined(userParams)) {\n    return defaultParams || {}\n  }\n\n  return merge(defaultParams, userParams)\n}\n\n/**\n * Converts the given value of unknown type to an array without\n * the risks of any exceptions.\n *\n * @param data - The value to convert to an array.\n *\n * @returns The converted array or an empty array if the value cannot be interpreted as an array.\n */\nexport function toSafeArray(data: any): any[] {\n  if (isNullOrUndefined(data)) {\n    return []\n  }\n\n  if (typeof data === \"number\" || typeof data === \"boolean\") {\n    // Single number or boolean\n    return [data]\n  }\n\n  if (typeof data === \"string\") {\n    if (data === \"\") {\n      // Empty string\n      return []\n    }\n\n    // Try to parse string to an array\n    if (data.trim().startsWith(\"[\") && data.trim().endsWith(\"]\")) {\n      // Support for JSON arrays: [\"foo\", 1, null, \"test\"]\n      try {\n        return JSON.parse(data)\n      } catch (error) {\n        return [data]\n      }\n    } else {\n      // Support for comma-separated values: \"foo,1,,test\"\n      return data.split(\",\")\n    }\n  }\n\n  try {\n    const parsedData = JSON.parse(\n      JSON.stringify(data, (_key, value) =>\n        typeof value === \"bigint\" ? Number(value) : value\n      )\n    )\n    if (!isArray(parsedData)) {\n      return [toSafeString(parsedData)]\n    }\n\n    return parsedData.map((value: any) =>\n      [\"string\", \"number\", \"boolean\", \"null\"].includes(typeof value)\n        ? value\n        : toSafeString(value)\n    )\n  } catch (error) {\n    return [toSafeString(data)]\n  }\n}\n\n/**\n * Converts the given value of unknown type to a string without\n * the risks of any exceptions.\n *\n * @param data - The value to convert to a string.\n *\n * @return The converted string or a string showing the type of the object as fallback.\n */\nexport function toSafeString(data: any): string {\n  try {\n    try {\n      return toString(data)\n    } catch (error) {\n      return JSON.stringify(data, (_key, value) =>\n        typeof value === \"bigint\" ? Number(value) : value\n      )\n    }\n  } catch (error) {\n    // This is most likely an object that cannot be converted to a string\n    // console.log converts this to `[object Object]` which we are doing here as well:\n    return `[${typeof data}]`\n  }\n}\n\n/**\n * Converts the given value of unknown type to a number without\n * the risks of any exceptions.\n *\n * @param value - The value to convert to a number.\n *\n * @returns The converted number or null if the value cannot be interpreted as a number.\n */\nexport function toSafeNumber(value: any): number | null {\n  // TODO(lukasmasuch): Should this return null as replacement for NaN?\n\n  if (isNullOrUndefined(value)) {\n    return null\n  }\n\n  if (isArray(value)) {\n    return NaN\n  }\n\n  if (typeof value === \"string\") {\n    if (value.trim().length === 0) {\n      // Empty string should return null\n      return null\n    }\n\n    try {\n      // Try to convert string to number via numbro:\n      // https://numbrojs.com/old-format.html#unformat\n      const unformattedValue = numbro.unformat(value.trim())\n      if (notNullOrUndefined(unformattedValue)) {\n        return unformattedValue\n      }\n    } catch (error) {\n      // Do nothing here\n    }\n  } else if (value instanceof Int32Array) {\n    // int values need to be extracted this way:\n    // eslint-disable-next-line prefer-destructuring\n    return Number(value[0])\n  }\n\n  return Number(value)\n}\n\n/**\n * Formats the given number to a string with the given maximum precision.\n *\n * @param value - The number to format.\n * @param maxPrecision - The maximum number of decimals to show.\n * @param keepTrailingZeros - Whether to keep trailing zeros.\n *\n * @returns The formatted number as a string.\n */\nexport function formatNumber(\n  value: number,\n  maxPrecision = 4,\n  keepTrailingZeros = false\n): string {\n  if (!Number.isNaN(value) && Number.isFinite(value)) {\n    if (maxPrecision === 0) {\n      // Numbro is unable to format the numb with 0 decimals.\n      value = Math.round(value)\n    }\n    return numbro(value).format(\n      keepTrailingZeros\n        ? `0,0.${\"0\".repeat(maxPrecision)}`\n        : `0,0.[${\"0\".repeat(maxPrecision)}]`\n    )\n  }\n  return \"\"\n}\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell, TextCell, GridCellKind } from \"@glideapps/glide-data-grid\"\n\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  getErrorCell,\n  ColumnCreator,\n  toSafeString,\n} from \"./utils\"\n\n/**\n * A column type for read-only cells used as a fallback\n * for data types that are currently not supported for editing.\n */\nfunction ObjectColumn(props: BaseColumnProps): BaseColumn {\n  const cellTemplate = {\n    kind: GridCellKind.Text,\n    data: \"\",\n    displayData: \"\",\n    allowOverlay: true,\n    contentAlignment: props.contentAlignment,\n    readonly: true,\n    style: props.isIndex ? \"faded\" : \"normal\",\n  } as TextCell\n  return {\n    ...props,\n    kind: \"object\",\n    sortMode: \"default\",\n    isEditable: false, // Object columns are read-only.\n    getCell(data?: any): GridCell {\n      try {\n        const cellData = notNullOrUndefined(data) ? toSafeString(data) : null\n        const displayData = notNullOrUndefined(cellData) ? cellData : \"\"\n        return {\n          ...cellTemplate,\n          data: cellData,\n          displayData,\n          isMissingValue: isNullOrUndefined(data),\n        } as TextCell\n      } catch (error) {\n        return getErrorCell(\n          toSafeString(data),\n          `The value cannot be interpreted as a string. Error: ${error}`\n        )\n      }\n    },\n    getCellValue(cell: TextCell): string | null {\n      return cell.data === undefined ? null : cell.data\n    },\n  }\n}\n\nObjectColumn.isEditableType = false\n\nexport default ObjectColumn as ColumnCreator\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell, TextCell, GridCellKind } from \"@glideapps/glide-data-grid\"\n\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  getErrorCell,\n  ColumnCreator,\n  toSafeString,\n} from \"./utils\"\n\n/**\n * A column that supports rendering & editing of text values.\n */\nfunction TextColumn(props: BaseColumnProps): BaseColumn {\n  const cellTemplate = {\n    kind: GridCellKind.Text,\n    data: \"\",\n    displayData: \"\",\n    allowOverlay: true,\n    contentAlignment: props.contentAlignment,\n    readonly: !props.isEditable,\n    style: props.isIndex ? \"faded\" : \"normal\",\n  } as TextCell\n\n  return {\n    ...props,\n    kind: \"text\",\n    sortMode: \"default\",\n    getCell(data?: any): GridCell {\n      try {\n        const cellData = notNullOrUndefined(data) ? toSafeString(data) : null\n        const displayData = notNullOrUndefined(cellData) ? cellData : \"\"\n        return {\n          ...cellTemplate,\n          isMissingValue: isNullOrUndefined(cellData),\n          data: cellData,\n          displayData,\n        } as TextCell\n      } catch (error) {\n        // This should never happen, but if it does, we want to show an error\n        return getErrorCell(\n          \"Incompatible value\",\n          `The value cannot be interpreted as string. Error: ${error}`\n        )\n      }\n    },\n    getCellValue(cell: TextCell): string | null {\n      return cell.data === undefined ? null : cell.data\n    },\n  }\n}\n\nTextColumn.isEditableType = true\n\nexport default TextColumn as ColumnCreator\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GridCell,\n  BooleanCell,\n  GridCellKind,\n} from \"@glideapps/glide-data-grid\"\n\nimport { notNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  getErrorCell,\n  ColumnCreator,\n  toSafeString,\n} from \"./utils\"\n\n// See pydantic for inspiration: https://pydantic-docs.helpmanual.io/usage/types/#booleans\nconst BOOLEAN_TRUE_VALUES = [\"true\", \"t\", \"yes\", \"y\", \"on\", \"1\"]\nconst BOOLEAN_FALSE_VALUES = [\"false\", \"f\", \"no\", \"n\", \"off\", \"0\"]\n\n/**\n * A column type that supports optimized rendering and editing for boolean values\n * by using checkboxes.\n */\nfunction BooleanColumn(props: BaseColumnProps): BaseColumn {\n  const cellTemplate = {\n    kind: GridCellKind.Boolean,\n    data: false,\n    allowOverlay: false, // no overlay possible\n    contentAlign: props.contentAlignment,\n    readonly: !props.isEditable,\n    style: props.isIndex ? \"faded\" : \"normal\",\n  } as BooleanCell\n\n  return {\n    ...props,\n    kind: \"boolean\",\n    sortMode: \"default\",\n    getCell(data?: any): GridCell {\n      let cellData = null\n\n      if (notNullOrUndefined(data)) {\n        if (typeof data === \"boolean\") {\n          cellData = data\n        } else {\n          const cleanedValue = String(data).toLowerCase().trim()\n          if (cleanedValue === \"\") {\n            cellData = null\n          } else if (BOOLEAN_TRUE_VALUES.includes(cleanedValue)) {\n            cellData = true\n          } else if (BOOLEAN_FALSE_VALUES.includes(cleanedValue)) {\n            cellData = false\n          } else {\n            return getErrorCell(\n              toSafeString(data),\n              `The value cannot be interpreted as boolean.`\n            )\n          }\n        }\n      }\n\n      // We are not setting isMissingValue here because the checkbox column\n      // does not work with the missing cell rendering.\n      return {\n        ...cellTemplate,\n        data: cellData,\n      } as BooleanCell\n    },\n    getCellValue(cell: BooleanCell): boolean | null {\n      return cell.data === undefined ? null : cell.data\n    },\n  }\n}\n\nBooleanColumn.isEditableType = true\n\nexport default BooleanColumn as ColumnCreator\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell, GridCellKind } from \"@glideapps/glide-data-grid\"\nimport { DropdownCellType } from \"@glideapps/glide-data-grid-cells\"\n\nimport { Quiver } from \"src/lib/Quiver\"\nimport { notNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  ColumnCreator,\n  getErrorCell,\n  toSafeString,\n  mergeColumnParameters,\n} from \"./utils\"\n\nexport interface CategoricalColumnParams {\n  /** A list of options available in the dropdown.\n   * Every value in the column needs to match one of the options.\n   */\n  readonly options: string[]\n}\n\n/**\n * A column type that supports optimized rendering and editing for categorical values\n * by using a dropdown. This is automatically used by categorical columns (Pandas).\n *\n */\nfunction CategoricalColumn(props: BaseColumnProps): BaseColumn {\n  const parameters = mergeColumnParameters(\n    // Default parameters:\n    {\n      options:\n        Quiver.getTypeName(props.arrowType) === \"bool\"\n          ? [\"true\", \"false\"]\n          : [],\n    },\n    // User parameters:\n    props.columnTypeMetadata\n  ) as CategoricalColumnParams\n\n  const cellTemplate = {\n    kind: GridCellKind.Custom,\n    allowOverlay: props.isEditable,\n    copyData: \"\",\n    contentAlign: props.contentAlignment,\n    data: {\n      kind: \"dropdown-cell\",\n      allowedValues: [\n        \"\", // Enforce the empty option\n        ...parameters.options.filter(opt => opt !== \"\"), // ignore empty option if it exists\n      ],\n      value: \"\",\n      readonly: !props.isEditable,\n    },\n  } as DropdownCellType\n\n  return {\n    ...props,\n    kind: \"categorical\",\n    sortMode: \"default\",\n    getCell(data?: any): GridCell {\n      // Empty string refers to a missing value\n      let cellData = \"\"\n      if (notNullOrUndefined(data)) {\n        cellData = toSafeString(data)\n      }\n\n      if (!cellTemplate.data.allowedValues.includes(cellData)) {\n        return getErrorCell(\n          toSafeString(cellData),\n          `The value is not part of the allowed options.`\n        )\n      }\n      return {\n        ...cellTemplate,\n        isMissingValue: cellData === \"\",\n        copyData: cellData, // Column sorting is done via the copyData value\n        data: {\n          ...cellTemplate.data,\n          value: cellData,\n        },\n      } as DropdownCellType\n    },\n    getCellValue(cell: DropdownCellType): string | null {\n      if (cell.data?.value === undefined || cell.data?.value === \"\") {\n        return null\n      }\n      return cell.data?.value\n    },\n  }\n}\n\nCategoricalColumn.isEditableType = true\n\nexport default CategoricalColumn as ColumnCreator\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell, BubbleCell, GridCellKind } from \"@glideapps/glide-data-grid\"\n\nimport { isNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  ColumnCreator,\n  toSafeArray,\n} from \"./utils\"\n\n/**\n * A column type that supports optimized rendering values of array/list types.\n */\nfunction ListColumn(props: BaseColumnProps): BaseColumn {\n  const cellTemplate = {\n    kind: GridCellKind.Bubble,\n    data: [],\n    allowOverlay: true,\n    contentAlign: props.contentAlignment,\n    style: props.isIndex ? \"faded\" : \"normal\",\n  } as BubbleCell\n\n  return {\n    ...props,\n    kind: \"list\",\n    sortMode: \"default\",\n    isEditable: false, // List column is always readonly\n    getCell(data?: any): GridCell {\n      // TODO(lukasmasuch): if notNullOrUndefined -> use empty cell to return null value\n      return {\n        ...cellTemplate,\n        data: toSafeArray(data),\n        isMissingValue: isNullOrUndefined(data),\n      } as BubbleCell\n    },\n    getCellValue(cell: BubbleCell): string[] | null {\n      return cell.data === undefined ? null : cell.data\n    },\n  }\n}\n\nListColumn.isEditableType = false\n\nexport default ListColumn as ColumnCreator\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell, GridCellKind, NumberCell } from \"@glideapps/glide-data-grid\"\n\nimport { Quiver } from \"src/lib/Quiver\"\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  getErrorCell,\n  ColumnCreator,\n  toSafeString,\n  mergeColumnParameters,\n  toSafeNumber,\n  formatNumber,\n} from \"./utils\"\n\nexport interface NumberColumnParams {\n  // Floating point precision to limit the number of digits after the decimal point.\n  // This is set to 0 for integer columns.\n  readonly precision?: number\n  // The minimum allowed value for editing. Is set to 0 for unsigned values.\n  readonly min?: number\n  // The maximum allowed value for editing.\n  readonly max?: number\n}\n\n/**\n * A column types that supports optimized rendering and editing for numbers.\n * This supports float, integer, and unsigned integer types.\n */\nfunction NumberColumn(props: BaseColumnProps): BaseColumn {\n  const arrowTypeName = Quiver.getTypeName(props.arrowType)\n\n  const parameters = mergeColumnParameters(\n    // Default parameters:\n    {\n      precision:\n        arrowTypeName.startsWith(\"int\") ||\n        arrowTypeName === \"range\" ||\n        arrowTypeName.startsWith(\"uint\")\n          ? 0\n          : undefined,\n      // if uint (unsigned int), only positive numbers are allowed\n      min: arrowTypeName.startsWith(\"uint\") ? 0 : undefined,\n    },\n    // User parameters:\n    props.columnTypeMetadata\n  ) as NumberColumnParams\n\n  const allowNegative = isNullOrUndefined(parameters.min) || parameters.min < 0\n  const fixedDecimals = notNullOrUndefined(parameters.precision)\n    ? parameters.precision\n    : undefined\n\n  const cellTemplate = {\n    kind: GridCellKind.Number,\n    data: undefined,\n    displayData: \"\",\n    readonly: !props.isEditable,\n    allowOverlay: true,\n    contentAlign: props.contentAlignment || \"right\",\n    style: props.isIndex ? \"faded\" : \"normal\",\n    allowNegative,\n    fixedDecimals,\n  } as NumberCell\n\n  return {\n    ...props,\n    kind: \"number\",\n    sortMode: \"smart\",\n    getCell(data?: any): GridCell {\n      let cellData: number | null = toSafeNumber(data)\n\n      if (notNullOrUndefined(cellData)) {\n        if (Number.isNaN(cellData)) {\n          return getErrorCell(\n            toSafeString(data),\n            \"The value cannot be interpreted as a number.\"\n          )\n        }\n\n        // Apply precision parameter\n        if (notNullOrUndefined(parameters.precision)) {\n          cellData =\n            parameters.precision === 0\n              ? Math.trunc(cellData)\n              : Math.trunc(cellData * 10 ** parameters.precision) /\n                10 ** parameters.precision\n        }\n\n        // Apply min parameter\n        if (notNullOrUndefined(parameters.min)) {\n          cellData = Math.max(cellData, parameters.min)\n        }\n\n        // Apply max parameter\n        if (notNullOrUndefined(parameters.max)) {\n          cellData = Math.min(cellData, parameters.max)\n        }\n      }\n\n      return {\n        ...cellTemplate,\n        data: cellData,\n        displayData: notNullOrUndefined(cellData)\n          ? formatNumber(cellData)\n          : \"\",\n        isMissingValue: isNullOrUndefined(cellData),\n      } as NumberCell\n    },\n    getCellValue(cell: NumberCell): number | null {\n      return cell.data === undefined ? null : cell.data\n    },\n  }\n}\n\nNumberColumn.isEditableType = true\n\nexport default NumberColumn as ColumnCreator\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport ObjectColumn from \"./ObjectColumn\"\nimport TextColumn from \"./TextColumn\"\nimport BooleanColumn from \"./BooleanColumn\"\nimport CategoricalColumn from \"./CategoricalColumn\"\nimport ListColumn from \"./ListColumn\"\nimport NumberColumn from \"./NumberColumn\"\n\nimport { ColumnCreator } from \"./utils\"\n\nexport * from \"./utils\"\n\n/**\n * All available column types need to be registered here.\n */\nexport const ColumnTypes = new Map<string, ColumnCreator>(\n  Object.entries({\n    object: ObjectColumn,\n    text: TextColumn,\n    boolean: BooleanColumn,\n    categorical: CategoricalColumn,\n    list: ListColumn,\n    number: NumberColumn,\n  })\n)\n\nexport {\n  ObjectColumn,\n  TextColumn,\n  BooleanColumn,\n  CategoricalColumn,\n  ListColumn,\n  NumberColumn,\n}\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GridCell,\n  Theme as GlideTheme,\n  TextCell,\n  NumberCell,\n  GridCellKind,\n} from \"@glideapps/glide-data-grid\"\n\nimport { DataFrameCell, Quiver, Type as ArrowType } from \"src/lib/Quiver\"\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\n\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  ColumnCreator,\n  ObjectColumn,\n  BooleanColumn,\n  NumberColumn,\n  TextColumn,\n  CategoricalColumn,\n  ListColumn,\n  isErrorCell,\n} from \"./columns\"\n\n/**\n * Extracts a CSS property value from a given CSS style string by using a regex.\n *\n * @param htmlElementId - The ID of the HTML element to extract the property for.\n * @param property - The css property to extract the value for.\n * @param cssStyle - The css style string.\n *\n * @return the CSS property value or undefined if the property is not found.\n */\nexport function extractCssProperty(\n  htmlElementId: string,\n  property: string,\n  cssStyle: string\n): string | undefined {\n  // This regex is supposed to extract the value of a CSS property\n  // for a specified HTML element ID from a CSS style string:\n  const regex = new RegExp(\n    `${htmlElementId}[,\\\\s].*{(?:[^}]*[\\\\s;]{1})?${property}:\\\\s*([^;}]+)[;]?.*}`,\n    \"gm\"\n  )\n  // Makes the regex simpler to match the element correctly:\n  cssStyle = cssStyle.replace(/{/g, \" {\")\n\n  const match = regex.exec(cssStyle)\n  if (match) {\n    return match[1].trim()\n  }\n\n  return undefined\n}\n\nexport function processDisplayData(displayData: string): string {\n  // Remove all line breaks\n  return displayData.replace(/(\\r\\n|\\n|\\r)/gm, \" \")\n}\n\n/**\n * Applies pandas styler CSS to style the cell.\n *\n * @param cell: The cell to style.\n * @param cssId: The css ID of the cell.\n * @param cssStyles: All CSS styles from pandas styler.\n *\n * @return a styled grid cell.\n */\nexport function applyPandasStylerCss(\n  cell: GridCell,\n  cssId: string,\n  cssStyles: string\n): GridCell {\n  const themeOverride = {} as Partial<GlideTheme>\n\n  // Extract and apply the font color\n  const fontColor = extractCssProperty(cssId, \"color\", cssStyles)\n  if (fontColor) {\n    themeOverride.textDark = fontColor\n  }\n\n  // Extract and apply the background color\n  const backgroundColor = extractCssProperty(\n    cssId,\n    \"background-color\",\n    cssStyles\n  )\n  if (backgroundColor) {\n    themeOverride.bgCell = backgroundColor\n  }\n\n  if (themeOverride) {\n    // Apply the background and font color in the theme override\n    return {\n      ...cell,\n      themeOverride,\n    }\n  }\n  return cell\n}\n\n/**\n * Maps the data type from Arrow to a column type.\n */\nexport function getColumnTypeFromArrow(arrowType: ArrowType): ColumnCreator {\n  let typeName = arrowType ? Quiver.getTypeName(arrowType) : null\n\n  if (!typeName) {\n    // Use object column as fallback\n    return ObjectColumn\n  }\n\n  typeName = typeName.toLowerCase().trim()\n  // Match based on arrow types\n  if ([\"unicode\", \"empty\"].includes(typeName)) {\n    return TextColumn\n  }\n  if (\n    [\n      \"object\",\n      \"date\",\n      \"time\",\n      \"datetime\",\n      \"datetimetz\",\n      \"decimal\",\n      \"bytes\",\n    ].includes(typeName)\n  ) {\n    return ObjectColumn\n  }\n  if ([\"bool\"].includes(typeName)) {\n    return BooleanColumn\n  }\n  if (\n    [\n      \"int8\",\n      \"int16\",\n      \"int32\",\n      \"int64\",\n      \"uint8\",\n      \"uint16\",\n      \"uint32\",\n      \"uint64\",\n      \"float16\",\n      \"float32\",\n      \"float64\",\n      \"float96\",\n      \"float128\",\n      \"range\", // The default index in pandas uses a range type.\n    ].includes(typeName)\n  ) {\n    return NumberColumn\n  }\n  if (typeName === \"categorical\") {\n    return CategoricalColumn\n  }\n  if (typeName.startsWith(\"list\")) {\n    return ListColumn\n  }\n\n  return ObjectColumn\n}\n\n/**\n * Creates the column props for an index column from the Arrow metadata.\n *\n * @param data - The Arrow data.\n * @param indexPosition - The numeric position of the index column.\n *\n * @return the column props for the index column.\n */\nexport function getIndexFromArrow(\n  data: Quiver,\n  indexPosition: number\n): BaseColumnProps {\n  const arrowType = data.types.index[indexPosition]\n  const title = data.indexNames[indexPosition]\n  let isEditable = true\n\n  if (Quiver.getTypeName(arrowType) === \"range\") {\n    // Range indices are not editable\n    isEditable = false\n  }\n\n  return {\n    id: `index-${indexPosition}`,\n    isEditable,\n    title,\n    arrowType,\n    isIndex: true,\n    isHidden: false,\n  } as BaseColumnProps\n}\n\n/**\n * Creates the column props for a data column from the Arrow metadata.\n *\n * @param data - The Arrow data.\n * @param columnPosition - The numeric position of the data column.\n *\n * @return the column props for the data column.\n */\nexport function getColumnFromArrow(\n  data: Quiver,\n  columnPosition: number\n): BaseColumnProps {\n  const title = data.columns[0][columnPosition]\n  let arrowType = data.types.data[columnPosition]\n\n  if (isNullOrUndefined(arrowType)) {\n    // Use empty column type as fallback\n    arrowType = {\n      meta: null,\n      numpy_type: \"object\",\n      pandas_type: \"object\",\n    } as ArrowType\n  }\n\n  let columnTypeMetadata\n  if (Quiver.getTypeName(arrowType) === \"categorical\") {\n    // Get the available categories and use it in column type metadata\n    const options = data.getCategoricalOptions(columnPosition)\n    if (notNullOrUndefined(options)) {\n      columnTypeMetadata = {\n        options: [\"\", ...options.filter(opt => opt !== \"\")],\n      }\n    }\n  }\n\n  return {\n    id: `column-${title}-${columnPosition}`,\n    isEditable: true,\n    title,\n    arrowType,\n    columnTypeMetadata,\n    isIndex: false,\n    isHidden: false,\n  } as BaseColumnProps\n}\n\n/**\n * Creates the column props for an empty index column.\n * This is used for DataFrames that don't have any index.\n * At least one column is required for glide.\n */\nexport function getEmptyIndexColumn(): BaseColumnProps {\n  return {\n    id: `empty-index`,\n    title: \"\",\n    indexNumber: 0,\n    isEditable: false,\n    isIndex: true,\n  } as BaseColumnProps\n}\n\n/**\n * Creates the column props for all columns from the Arrow metadata.\n *\n * @param data - The Arrow data.\n * @return the column props for all columns.\n */\nexport function getAllColumnsFromArrow(data: Quiver): BaseColumnProps[] {\n  const columns: BaseColumnProps[] = []\n\n  // TODO(lukasmasuch): use data.dimensions instead here?\n  const numIndices = data.types?.index?.length ?? 0\n  const numColumns = data.columns?.[0]?.length ?? 0\n\n  if (numIndices === 0 && numColumns === 0) {\n    // Tables that don't have any columns cause an exception in glide-data-grid.\n    // As a workaround, we are adding an empty index column in this case.\n    columns.push(getEmptyIndexColumn())\n    return columns\n  }\n\n  for (let i = 0; i < numIndices; i++) {\n    const column = {\n      ...getIndexFromArrow(data, i),\n      indexNumber: i,\n    } as BaseColumnProps\n\n    columns.push(column)\n  }\n\n  for (let i = 0; i < numColumns; i++) {\n    const column = {\n      ...getColumnFromArrow(data, i),\n      indexNumber: i + numIndices,\n    } as BaseColumnProps\n\n    columns.push(column)\n  }\n  return columns\n}\n\n/**\n * Returns a glide-data-grid compatible cell object based on the\n * cell data from the Quiver (Arrow) object. Different types of data will\n * result in different cell types.\n *\n * @param column - The colum of the cell.\n * @param arrowCell - The dataframe cell object from Arrow.\n * @param cssStyles - Optional css styles to apply on the cell.\n *\n * @return a GridCell object that can be used by glide-data-grid.\n */\nexport function getCellFromArrow(\n  column: BaseColumn,\n  arrowCell: DataFrameCell,\n  cssStyles: string | undefined = undefined\n): GridCell {\n  let cellTemplate\n  if (column.kind === \"object\") {\n    // Always use display value from Quiver for object types\n    // these are special types that the dataframe only support in read-only mode.\n    cellTemplate = column.getCell(\n      notNullOrUndefined(arrowCell.content)\n        ? processDisplayData(\n            Quiver.format(\n              arrowCell.content,\n              arrowCell.contentType,\n              arrowCell.field\n            )\n          )\n        : null\n    )\n  } else {\n    cellTemplate = column.getCell(arrowCell.content)\n  }\n\n  if (isErrorCell(cellTemplate)) {\n    // Directly return error cells without any additional modification\n    return cellTemplate\n  }\n\n  if (notNullOrUndefined(arrowCell.displayContent)) {\n    const displayData = processDisplayData(arrowCell.displayContent)\n    // If the display content is set, use that instead of the content.\n    // This is only supported for text, object, date, datetime, time and number cells.\n    if (cellTemplate.kind === GridCellKind.Text) {\n      cellTemplate = {\n        ...cellTemplate,\n        displayData,\n      } as TextCell\n    } else if (cellTemplate.kind === GridCellKind.Number) {\n      cellTemplate = {\n        ...cellTemplate,\n        displayData,\n      } as NumberCell\n    }\n    // TODO (lukasmasuch): Also support datetime formatting here\n  }\n\n  if (cssStyles && arrowCell.cssId) {\n    cellTemplate = applyPandasStylerCss(\n      cellTemplate,\n      arrowCell.cssId,\n      cssStyles\n    )\n  }\n  return cellTemplate\n}\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport { merge } from \"lodash\"\nimport { GridCell, DataEditorProps } from \"@glideapps/glide-data-grid\"\n\nimport { Quiver } from \"src/lib/Quiver\"\nimport { Arrow as ArrowProto } from \"src/autogen/proto\"\nimport { notNullOrUndefined, isNullOrUndefined } from \"src/lib/utils\"\nimport { logWarning, logError } from \"src/lib/log\"\n\nimport {\n  getColumnTypeFromArrow,\n  getAllColumnsFromArrow,\n  getCellFromArrow,\n  getEmptyIndexColumn,\n} from \"src/components/widgets/DataFrame/arrowUtils\"\nimport EditingState from \"src/components/widgets/DataFrame/EditingState\"\nimport {\n  BaseColumn,\n  BaseColumnProps,\n  getErrorCell,\n  ObjectColumn,\n  ColumnTypes,\n  ColumnCreator,\n} from \"src/components/widgets/DataFrame/columns\"\n\n// Using this ID for column config will apply the config to all index columns\nexport const INDEX_IDENTIFIER = \"index\"\n// Prefix used in the config column mapping when referring to a column via the numeric position\nexport const COLUMN_POSITION_PREFIX = \"col:\"\n\n/**\n * Options to configure columns.\n */\nexport interface ColumnConfigProps {\n  width?: number\n  title?: string\n  type?: string\n  hidden?: boolean\n  editable?: boolean\n  metadata?: Record<string, unknown>\n  alignment?: string\n}\n\n/**\n * Apply the user-defined column configuration if supplied.\n *\n * @param columnProps - The column properties to apply the config to.\n * @param columnConfigMapping - The user-defined column configuration mapping.\n *\n * @return the column properties with the config applied.\n */\nexport function applyColumnConfig(\n  columnProps: BaseColumnProps,\n  columnConfigMapping: Map<string | number, ColumnConfigProps>\n): BaseColumnProps {\n  if (!columnConfigMapping) {\n    // No column config configured\n    return columnProps\n  }\n\n  let columnConfig\n  if (columnConfigMapping.has(columnProps.title)) {\n    // Config is configured based on the column title\n    columnConfig = columnConfigMapping.get(columnProps.title)\n  } else if (\n    columnConfigMapping.has(\n      `${COLUMN_POSITION_PREFIX}${columnProps.indexNumber}`\n    )\n  ) {\n    // Config is configured based on the column position, e.g. col:0 -> first column\n    columnConfig = columnConfigMapping.get(\n      `${COLUMN_POSITION_PREFIX}${columnProps.indexNumber}`\n    )\n  } else if (\n    columnProps.isIndex &&\n    columnConfigMapping.has(INDEX_IDENTIFIER)\n  ) {\n    // Config is configured for the index column (or all index columns for multi-index)\n    columnConfig = columnConfigMapping.get(INDEX_IDENTIFIER)\n  }\n\n  if (!columnConfig) {\n    // No column config found for this column\n    return columnProps\n  }\n\n  // This will update all column props with the user-defined config for all\n  // configuration option that are not undefined:\n  return merge(\n    { ...columnProps },\n    {\n      title: columnConfig.title,\n      width: columnConfig.width,\n      customType: columnConfig.type?.toLowerCase().trim(),\n      isEditable: columnConfig.editable,\n      isHidden: columnConfig.hidden,\n      columnTypeMetadata: columnConfig.metadata,\n      contentAlignment: columnConfig.alignment,\n    }\n  ) as BaseColumnProps\n}\n\n/**\n * Extracts the user-defined column configuration from the proto message.\n *\n * @param element - The proto message of the dataframe element.\n *\n * @returns the user-defined column configuration.\n */\nexport function getColumnConfig(element: ArrowProto): Map<string, any> {\n  if (!element.columns) {\n    return new Map()\n  }\n  try {\n    return new Map(Object.entries(JSON.parse(element.columns)))\n  } catch (error) {\n    // This is not expected to happen, but if it does, we'll return an empty map\n    // and log the error to the console.\n    logError(error)\n    return new Map()\n  }\n}\n\ntype DataLoaderReturn = {\n  columns: BaseColumn[]\n} & Pick<DataEditorProps, \"getCellContent\">\n\n/**\n * Get the column type (creator class of column type) for the given column properties.\n *\n * @param column - The column properties.\n *\n * @returns the column creator of the corresponding column type.\n */\nexport function getColumnType(column: BaseColumnProps): ColumnCreator {\n  // Create a column instance based on the column properties\n  let ColumnType: ColumnCreator | undefined\n  if (notNullOrUndefined(column.customType)) {\n    if (ColumnTypes.has(column.customType)) {\n      ColumnType = ColumnTypes.get(column.customType)\n    } else {\n      logWarning(\n        `Unknown column type configured in column configuration: ${column.customType}`\n      )\n    }\n  }\n  if (isNullOrUndefined(ColumnType)) {\n    // Load based on arrow type\n    ColumnType = getColumnTypeFromArrow(column.arrowType)\n  }\n  return ColumnType\n}\n\n/**\n * Custom hook that handles all data loading capabilities for the interactive data table.\n * This also includes the logic to load and configure columns.\n *\n * @param element - The proto message of the dataframe element\n * @param data - The Arrow data extracted from the proto message\n * @param numRows - The number of rows of the current state (includes row additions/deletions)\n * @param disabled - Whether the widget is disabled\n * @param editingState - The editing state of the data editor\n *\n * @returns the columns and the cell content getter compatible with glide-data-grid.\n */\nfunction useDataLoader(\n  element: ArrowProto,\n  data: Quiver,\n  numRows: number,\n  disabled: boolean,\n  editingState: React.MutableRefObject<EditingState>\n): DataLoaderReturn {\n  // TODO(lukasmasuch): We might use state to store the column config as additional optimization?\n  const columnConfigMapping = getColumnConfig(element)\n\n  const stretchColumns: boolean =\n    element.useContainerWidth ||\n    (notNullOrUndefined(element.width) && element.width > 0)\n\n  // Converts the columns from Arrow into columns compatible with glide-data-grid\n  const configuredColumns: BaseColumn[] = getAllColumnsFromArrow(data)\n    .map(column => {\n      // Apply column configurations\n      let updatedColumn = {\n        ...column,\n        ...applyColumnConfig(column, columnConfigMapping),\n        isStretched: stretchColumns,\n      } as BaseColumnProps\n\n      const ColumnType = getColumnType(updatedColumn)\n\n      // Make sure editing is deactivated if the column is read-only, disabled,\n      // or a not editable type.\n      if (\n        element.editingMode === ArrowProto.EditingMode.READ_ONLY ||\n        disabled ||\n        ColumnType.isEditableType === false\n      ) {\n        updatedColumn = {\n          ...updatedColumn,\n          isEditable: false,\n        }\n      }\n\n      return ColumnType(updatedColumn)\n    })\n    .filter(column => {\n      // Filter out all columns that are hidden\n      return !column.isHidden\n    })\n\n  // If all columns got filtered out, we add a an empty index column\n  // to prevent errors from glide-data-grid.\n  const columns =\n    configuredColumns.length > 0\n      ? configuredColumns\n      : [ObjectColumn(getEmptyIndexColumn())]\n\n  const getCellContent = React.useCallback(\n    ([col, row]: readonly [number, number]): GridCell => {\n      if (col > columns.length - 1) {\n        return getErrorCell(\n          \"Column index out of bounds.\",\n          \"This should never happen. Please report this bug.\"\n        )\n      }\n\n      if (row > numRows - 1) {\n        return getErrorCell(\n          \"Row index out of bounds.\",\n          \"This should never happen. Please report this bug.\"\n        )\n      }\n      const column = columns[col]\n\n      const originalCol = column.indexNumber\n      const originalRow = editingState.current.getOriginalRowIndex(row)\n\n      // Use editing state if editable or if it is an appended row\n      if (column.isEditable || editingState.current.isAddedRow(originalRow)) {\n        const editedCell = editingState.current.getCell(\n          originalCol,\n          originalRow\n        )\n        if (editedCell !== undefined) {\n          return editedCell\n        }\n      }\n\n      try {\n        // Arrow has the header in first row\n        const arrowCell = data.getCell(originalRow + 1, originalCol)\n        return getCellFromArrow(column, arrowCell, data.cssStyles)\n      } catch (error) {\n        logError(error)\n        return getErrorCell(\n          \"Error during cell creation.\",\n          `This should never happen. Please report this bug. \\nError: ${error}`\n        )\n      }\n    },\n    [columns, numRows, data, editingState]\n  )\n\n  return {\n    columns,\n    getCellContent,\n  }\n}\n\nexport default useDataLoader\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport { Size as ResizableSize } from \"re-resizable\"\n\nimport { Arrow as ArrowProto } from \"src/autogen/proto\"\nimport { notNullOrUndefined } from \"src/lib/utils\"\n\nconst ROW_HEIGHT = 35\n// Min width for the resizable table container:\n// Based on one column at minimum width + 2 for borders + 1 to prevent overlap problem with selection ring.\nconst MIN_TABLE_WIDTH = 52\n// Min height for the resizable table container:\n// Based on header + one column, and + 2 for borders + 1 to prevent overlap problem with selection ring.\nconst MIN_TABLE_HEIGHT = 2 * ROW_HEIGHT + 3\nconst DEFAULT_TABLE_HEIGHT = 400\n\nexport type AutoSizerReturn = {\n  rowHeight: number\n  minHeight: number\n  maxHeight: number\n  minWidth: number\n  maxWidth: number\n  resizableSize: ResizableSize\n  setResizableSize: React.Dispatch<React.SetStateAction<ResizableSize>>\n}\n\nexport function calculateMaxHeight(numRows: number): number {\n  // +2 pixels for borders\n  return Math.max(numRows * ROW_HEIGHT + 1 + 2, MIN_TABLE_HEIGHT)\n}\n/**\n * A custom React hook that manages all aspects related to the size of the table.\n *\n * @param element - The ArrowProto element\n * @param numRows - The number of rows in the table\n * @param containerWidth - The width of the surrounding container\n * @param containerHeight - The height of the surrounding container\n * @param isFullScreen - Whether the table is in fullscreen mode\n *\n * @returns The row height, min/max height & width, and the current size of the resizable container.\n */\nfunction useTableSizer(\n  element: ArrowProto,\n  numRows: number,\n  containerWidth: number,\n  containerHeight?: number,\n  isFullScreen?: boolean\n): AutoSizerReturn {\n  let maxHeight = calculateMaxHeight(\n    numRows +\n      1 + // Column header row\n      (element.editingMode === ArrowProto.EditingMode.DYNAMIC ? 1 : 0) // Trailing row\n  )\n\n  let initialHeight = Math.min(maxHeight, DEFAULT_TABLE_HEIGHT)\n\n  if (element.height) {\n    // User has explicitly configured a height\n    initialHeight = Math.max(element.height, MIN_TABLE_HEIGHT)\n    maxHeight = Math.max(element.height, maxHeight)\n  }\n\n  if (containerHeight) {\n    // If container height is set (e.g. when used in fullscreen)\n    // The maxHeight and height should not be larger than container height\n    initialHeight = Math.min(initialHeight, containerHeight)\n    maxHeight = Math.min(maxHeight, containerHeight)\n\n    if (!element.height) {\n      // If no explicit height is set, set height to max height (fullscreen mode)\n      initialHeight = maxHeight\n    }\n  }\n\n  let initialWidth: number | undefined // If container width is undefined, auto set based on column widths\n  let maxWidth = containerWidth\n\n  if (element.useContainerWidth) {\n    // Always use the full container width\n    initialWidth = containerWidth\n  } else if (element.width) {\n    // User has explicitly configured a width\n    initialWidth = Math.min(\n      Math.max(element.width, MIN_TABLE_WIDTH),\n      containerWidth\n    )\n    maxWidth = Math.min(Math.max(element.width, maxWidth), containerWidth)\n  }\n\n  const [resizableSize, setResizableSize] = React.useState<ResizableSize>({\n    width: initialWidth || \"100%\",\n    height: initialHeight,\n  })\n\n  React.useLayoutEffect(() => {\n    // This prevents weird table resizing behavior if the container width\n    // changes and the table uses the full container width.\n    if (element.useContainerWidth && resizableSize.width === \"100%\") {\n      setResizableSize({\n        width: containerWidth,\n        height: resizableSize.height,\n      })\n    }\n  }, [containerWidth])\n\n  // Reset the height if the number of rows changes (e.g. via add_rows):\n  React.useLayoutEffect(() => {\n    setResizableSize({\n      width: resizableSize.width,\n      height: initialHeight,\n    })\n  }, [numRows])\n\n  // Reset the width if the element width parameter was changed:\n  React.useLayoutEffect(() => {\n    setResizableSize({\n      width: initialWidth || \"100%\",\n      height: resizableSize.height,\n    })\n  }, [initialWidth])\n\n  // Reset the height if the element height parameter was changed:\n  React.useLayoutEffect(() => {\n    setResizableSize({\n      width: resizableSize.width,\n      height: initialHeight,\n    })\n  }, [initialHeight])\n\n  // Change sizing if the fullscreen mode is activated or deactivated:\n  React.useLayoutEffect(() => {\n    if (isFullScreen) {\n      const stretchColumns: boolean =\n        element.useContainerWidth ||\n        (notNullOrUndefined(element.width) && element.width > 0)\n      setResizableSize({\n        width: stretchColumns ? maxWidth : \"100%\",\n        height: maxHeight,\n      })\n    } else {\n      setResizableSize({\n        width: initialWidth || \"100%\",\n        height: initialHeight,\n      })\n    }\n  }, [isFullScreen])\n\n  return {\n    rowHeight: ROW_HEIGHT,\n    minHeight: MIN_TABLE_HEIGHT,\n    maxHeight,\n    minWidth: MIN_TABLE_WIDTH,\n    maxWidth,\n    resizableSize,\n    setResizableSize,\n  }\n}\n\nexport default useTableSizer\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\nimport {\n  EditableGridCell,\n  GridCell,\n  DataEditorProps,\n  GridSelection,\n  Item,\n} from \"@glideapps/glide-data-grid\"\n\nimport {\n  BaseColumn,\n  isErrorCell,\n} from \"src/components/widgets/DataFrame/columns\"\nimport EditingState from \"src/components/widgets/DataFrame/EditingState\"\n\n/**\n * Create return type for useDataLoader hook based on the DataEditorProps.\n */\ntype DataEditorReturn = Pick<\n  DataEditorProps,\n  \"onCellEdited\" | \"onPaste\" | \"onRowAppended\" | \"onDelete\"\n>\n\n/**\n * Custom hook to handle all aspects related to data editing. This includes editing cells,\n * pasting from clipboard, and appending & deleting rows.\n *\n * @param columns - The columns of the table.\n * @param fixedNumRows - Whether the number of rows is fixed. This means that rows cannot be added or deleted.\n * @param editingState - The editing state of the data editor.\n * @param getCellContent - Function to get a specific cell.\n * @param getOriginalIndex - Function to map a row ID of the current state to the original row ID.\n *                           This mainly changed by sorting of columns.\n * @param refreshCells - Callback that allows to trigger a UI refresh of a selection of cells.\n * @param applyEdits - Callback that needs to be called on all edits. This will also trigger a rerun\n *                     and send widget state to the backend.\n *\n * @returns Glide-data-grid compatible functions for editing capabilities.\n */\nfunction useDataEditor(\n  columns: BaseColumn[],\n  fixedNumRows: boolean,\n  editingState: React.MutableRefObject<EditingState>,\n  getCellContent: ([col, row]: readonly [number, number]) => GridCell,\n  getOriginalIndex: (index: number) => number,\n  refreshCells: (\n    cells: {\n      cell: [number, number]\n    }[]\n  ) => void,\n  applyEdits: (clearSelection?: boolean, triggerRerun?: boolean) => void\n): DataEditorReturn {\n  const onCellEdited = React.useCallback(\n    (\n      [col, row]: readonly [number, number],\n      updatedCell: EditableGridCell\n    ): void => {\n      const column = columns[col]\n\n      const originalCol = column.indexNumber\n\n      // We need to apply two different mappings here. One for the case that\n      // the user has sorted a column, and another one from the editing state\n      // to get the correct row ID when the user has deleted rows.\n      const originalRow = editingState.current.getOriginalRowIndex(\n        getOriginalIndex(row)\n      )\n      const currentCell = getCellContent([col, row])\n      const currentValue = column.getCellValue(currentCell)\n      const newValue = column.getCellValue(updatedCell)\n      if (!isErrorCell(currentCell) && newValue === currentValue) {\n        // No editing is required since the values did not change\n        return\n      }\n\n      const newCell = column.getCell(newValue)\n\n      editingState.current.setCell(originalCol, originalRow, {\n        ...newCell,\n        lastUpdated: performance.now(),\n      })\n\n      applyEdits()\n    },\n    [columns, editingState, getOriginalIndex, getCellContent, applyEdits]\n  )\n\n  const onRowAppended = React.useCallback(() => {\n    if (fixedNumRows) {\n      // Appending rows is not supported\n      return\n    }\n\n    const newRow: Map<number, GridCell> = new Map()\n    columns.forEach(column => {\n      newRow.set(column.indexNumber, column.getCell(undefined))\n    })\n    editingState.current.addRow(newRow)\n    applyEdits(false, false)\n  }, [columns, editingState, fixedNumRows])\n\n  const onDelete = React.useCallback(\n    (selection: GridSelection): GridSelection | boolean => {\n      if (selection.rows.length > 0) {\n        // User has selected one or more rows\n        if (fixedNumRows) {\n          // Deleting rows is not supported\n          return true\n        }\n\n        const rowsToDelete = selection.rows.toArray().map(row => {\n          return editingState.current.getOriginalRowIndex(\n            getOriginalIndex(row)\n          )\n        })\n        // We need to delete all rows at once, so that the indexes work correct\n        editingState.current.deleteRows(rowsToDelete)\n        applyEdits(true)\n        return false\n      }\n      if (selection.current?.range) {\n        // User has selected one or more cells\n        const updatedCells: { cell: [number, number] }[] = []\n        const selectedArea = selection.current.range\n        for (\n          let row = selectedArea.y;\n          row < selectedArea.y + selectedArea.height;\n          row++\n        ) {\n          for (\n            let col = selectedArea.x;\n            col < selectedArea.x + selectedArea.width;\n            col++\n          ) {\n            const column = columns[col]\n            if (column.isEditable) {\n              updatedCells.push({\n                cell: [col, row],\n              })\n              onCellEdited(\n                [col, row],\n                column.getCell(null) as EditableGridCell\n              )\n            }\n          }\n        }\n\n        if (updatedCells.length > 0) {\n          applyEdits()\n          refreshCells(updatedCells)\n        }\n        return false\n      }\n      return true\n    },\n    [\n      columns,\n      editingState,\n      fixedNumRows,\n      refreshCells,\n      getOriginalIndex,\n      applyEdits,\n    ]\n  )\n\n  const onPaste = React.useCallback(\n    (target: Item, values: readonly (readonly string[])[]): boolean => {\n      const [targetCol, targetRow] = target\n\n      const updatedCells: { cell: [number, number] }[] = []\n\n      for (let row = 0; row < values.length; row++) {\n        const rowData = values[row]\n        if (row + targetRow >= editingState.current.getNumRows()) {\n          if (fixedNumRows) {\n            // Only add new rows if editing mode is dynamic, otherwise break here\n            break\n          }\n          // Adding rows during paste would not work currently. However, we already disallow\n          // sorting in dynamic mode, so we don't have to do anything here.\n          onRowAppended()\n        }\n        for (let col = 0; col < rowData.length; col++) {\n          const pasteDataValue = rowData[col]\n\n          const rowIndex = row + targetRow\n          const colIndex = col + targetCol\n\n          if (colIndex >= columns.length) {\n            // We could potentially add new columns here in the future.\n            break\n          }\n\n          const column = columns[colIndex]\n          // Only add to columns that are editable:\n          if (column.isEditable) {\n            const newCell = column.getCell(pasteDataValue)\n            // We are not editing cells if the pasted value leads to an error:\n            if (!isErrorCell(newCell)) {\n              const originalCol = column.indexNumber\n              const originalRow = editingState.current.getOriginalRowIndex(\n                getOriginalIndex(rowIndex)\n              )\n              const currentValue = column.getCellValue(\n                getCellContent([colIndex, rowIndex])\n              )\n              const newValue = column.getCellValue(newCell)\n              // Edit the cell only if the value actually changed:\n              if (newValue !== currentValue) {\n                editingState.current.setCell(originalCol, originalRow, {\n                  ...newCell,\n                  lastUpdated: performance.now(),\n                })\n\n                updatedCells.push({\n                  cell: [colIndex, rowIndex],\n                })\n              }\n            }\n          }\n        }\n\n        if (updatedCells.length > 0) {\n          applyEdits()\n          refreshCells(updatedCells)\n        }\n      }\n\n      return false\n    },\n    [\n      columns,\n      editingState,\n      fixedNumRows,\n      getOriginalIndex,\n      getCellContent,\n      onRowAppended,\n      applyEdits,\n      refreshCells,\n    ]\n  )\n\n  return {\n    onCellEdited,\n    onPaste,\n    onRowAppended,\n    onDelete,\n  }\n}\n\nexport default useDataEditor\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from \"react\"\n\nimport { GridColumn, DataEditorProps } from \"@glideapps/glide-data-grid\"\n\ntype ColumnSizerReturn = Pick<DataEditorProps, \"columns\" | \"onColumnResize\">\n\n/**\n * Hook to manage the interactive column resizing capabilities.\n *\n * @param columns - The columns of the table.\n *\n * @returns An object containing the following properties:\n * - columns: The updated list of columns.\n * - onColumnResize: The callback function to be called when a column is resized.\n */\nfunction useColumnSizer(columns: GridColumn[]): ColumnSizerReturn {\n  // The columns with the corresponding empty template for every type:\n  const [columnSizes, setColumnSizes] = useState<Map<string, number>>(\n    () => new Map()\n  )\n\n  const onColumnResize = React.useCallback(\n    (\n      column: GridColumn,\n      _newSize: number,\n      _colIndex: number,\n      newSizeWithGrow: number\n    ) => {\n      if (column.id) {\n        setColumnSizes(new Map(columnSizes).set(column.id, newSizeWithGrow))\n      }\n    },\n    [columnSizes]\n  )\n\n  // Apply column widths from state:\n  const sizedColumns = columns.map(column => {\n    if (\n      column.id &&\n      columnSizes.has(column.id) &&\n      columnSizes.get(column.id) !== undefined\n    ) {\n      return {\n        ...column,\n        width: columnSizes.get(column.id),\n        // Deactivate grow whenever a column gets manually resized\n        grow: 0,\n      } as GridColumn\n    }\n    return column\n  })\n\n  return {\n    columns: sizedColumns,\n    onColumnResize,\n  }\n}\n\nexport default useColumnSizer\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from \"react\"\n\nimport {\n  GridColumn,\n  GridCell,\n  DataEditorProps,\n} from \"@glideapps/glide-data-grid\"\nimport { useColumnSort as useGlideColumnSort } from \"@glideapps/glide-data-grid-source\"\n\nimport {\n  BaseColumn,\n  toGlideColumn,\n} from \"src/components/widgets/DataFrame/columns\"\n\n/**\n * Configuration type for column sorting hook.\n */\ntype ColumnSortConfig = {\n  column: GridColumn\n  mode?: \"default\" | \"raw\" | \"smart\"\n  direction?: \"asc\" | \"desc\"\n}\n\n/**\n * Updates the column headers based on the sorting configuration.\n *\n * @param columns - The columns of the table.\n * @param sort - The current sorting configuration.\n *\n * @returns The updated list of columns.\n */\nfunction updateSortingHeader(\n  columns: BaseColumn[],\n  sort: ColumnSortConfig | undefined\n): BaseColumn[] {\n  if (sort === undefined) {\n    return columns\n  }\n  return columns.map(column => {\n    if (column.id === sort.column.id) {\n      return {\n        ...column,\n        title:\n          sort.direction === \"asc\" ? `↑ ${column.title}` : `↓ ${column.title}`,\n      }\n    }\n    return column\n  })\n}\n\ntype ColumnSortReturn = {\n  columns: BaseColumn[]\n  sortColumn: (index: number) => void\n  getOriginalIndex: (index: number) => number\n} & Pick<DataEditorProps, \"getCellContent\">\n\n/**\n * A React hook that provides column sorting functionality.\n *\n * @param numRows - The number of rows in the table.\n * @param columns - The columns of the table.\n *\n * @returns An object containing the following properties:\n * - `columns`: The updated list of columns.\n * - `sortColumn`: A function that sorts the column at the given index.\n * - `getOriginalIndex`: A function that returns the original index of the row at the given index.\n * - `getCellContent`: An updated function that returns the content of the cell at the given column and row indices.\n */\nfunction useColumnSort(\n  numRows: number,\n  columns: BaseColumn[],\n  getCellContent: ([col, row]: readonly [number, number]) => GridCell\n): ColumnSortReturn {\n  const [sort, setSort] = React.useState<ColumnSortConfig>()\n\n  const { getCellContent: getCellContentSorted, getOriginalIndex } =\n    useGlideColumnSort({\n      columns: columns.map(column => toGlideColumn(column)),\n      getCellContent,\n      rows: numRows,\n      sort,\n    })\n\n  const updatedColumns = updateSortingHeader(columns, sort)\n\n  const sortColumn = React.useCallback(\n    (index: number) => {\n      let sortDirection = \"asc\"\n      const clickedColumn = updatedColumns[index]\n\n      if (sort && sort.column.id === clickedColumn.id) {\n        // The clicked column is already sorted\n        if (sort.direction === \"asc\") {\n          // Sort column descending\n          sortDirection = \"desc\"\n        } else {\n          // Remove sorting of column\n          setSort(undefined)\n          return\n        }\n      }\n\n      setSort({\n        column: toGlideColumn(clickedColumn),\n        direction: sortDirection,\n        mode: clickedColumn.sortMode,\n      } as ColumnSortConfig)\n    },\n    [sort, updatedColumns]\n  )\n\n  return {\n    columns: updatedColumns,\n    sortColumn,\n    getOriginalIndex,\n    getCellContent: getCellContentSorted,\n  }\n}\n\nexport default useColumnSort\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport styled from \"@emotion/styled\"\n\n/**\n * A resizable data grid container component.\n */\nexport const StyledResizableContainer = styled.div(({ theme }) => ({\n  position: \"relative\",\n  display: \"inline-block\",\n\n  \"& .glideDataEditor\": {\n    height: \"100%\",\n    minWidth: \"100%\",\n    borderRadius: theme.radii.md,\n  },\n\n  \"& .dvn-scroller\": {\n    scrollbarWidth: \"thin\",\n    [\"overflowX\" as any]: \"overlay !important\",\n    [\"overflowY\" as any]: \"overlay !important\",\n  },\n}))\n","/**\n * Copyright (c) Streamlit Inc. (2018-2022) Snowflake Inc. (2022)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { ReactElement } from \"react\"\nimport {\n  DataEditor as GlideDataEditor,\n  DataEditorRef,\n  GridSelection,\n  CompactSelection,\n  GridMouseEventArgs,\n  drawTextCell,\n  DrawCustomCellCallback,\n  GridCell,\n} from \"@glideapps/glide-data-grid\"\nimport { useExtraCells } from \"@glideapps/glide-data-grid-cells\"\nimport { Resizable } from \"re-resizable\"\n\nimport { FormClearHelper } from \"src/components/widgets/Form\"\nimport withFullScreenWrapper from \"src/hocs/withFullScreenWrapper\"\nimport { Quiver } from \"src/lib/Quiver\"\nimport { Arrow as ArrowProto } from \"src/autogen/proto\"\nimport { WidgetInfo, WidgetStateManager } from \"src/lib/WidgetStateManager\"\nimport { debounce, isNullOrUndefined } from \"src/lib/utils\"\n\nimport EditingState from \"./EditingState\"\nimport {\n  useCustomTheme,\n  useTableSizer,\n  useDataLoader,\n  useDataEditor,\n  useColumnSizer,\n  useColumnSort,\n} from \"./hooks\"\nimport {\n  BaseColumn,\n  toGlideColumn,\n  isMissingValueCell,\n  getTextCell,\n} from \"./columns\"\nimport { StyledResizableContainer } from \"./styled-components\"\n\nimport \"@glideapps/glide-data-grid/dist/index.css\"\n\n// Min column width used for manual and automatic resizing\nconst MIN_COLUMN_WIDTH = 50\n// Max column width used for manual resizing\nconst MAX_COLUMN_WIDTH = 1000\n// Max column width used for automatic column sizing\nconst MAX_COLUMN_AUTO_WIDTH = 500\n// Debounce time for triggering a widget state update\n// This prevents to rapid updates to the widget state.\nconst DEBOUNCE_TIME_MS = 100\n// Token used for missing values (null, NaN, etc.)\nconst NULL_VALUE_TOKEN = \"None\"\n// Number of rows that triggers some optimization features\n// for large tables.\nconst LARGE_TABLE_ROWS_THRESHOLD = 150000\n\nexport interface DataFrameProps {\n  element: ArrowProto\n  data: Quiver\n  width: number\n  height?: number\n  disabled: boolean\n  widgetMgr: WidgetStateManager\n  isFullScreen?: boolean\n}\n\n/**\n * If a cell is marked as missing, we draw a placeholder symbol with a faded text color.\n * This is done by providing a custom cell renderer.\n */\nconst drawMissingCells: DrawCustomCellCallback = args => {\n  const { cell, theme } = args\n  if (isMissingValueCell(cell)) {\n    drawTextCell(\n      {\n        ...args,\n        theme: {\n          ...theme,\n          textDark: theme.textLight,\n          textMedium: theme.textLight,\n        },\n        // The following props are just added for technical reasons:\n        // @ts-ignore\n        spriteManager: {},\n        hyperWrapping: false,\n      },\n      NULL_VALUE_TOKEN,\n      cell.contentAlign\n    )\n    return true\n  }\n\n  return false\n}\n\n/**\n * The main component used by dataframe & data_editor to render an editable table.\n *\n * @param element - The element's proto message\n * @param data - The Arrow data to render (extracted from the proto message)\n * @param width - The width of the container\n * @param height - The height of the container\n * @param disabled - Whether the widget is disabled\n * @param widgetMgr - The widget manager\n * @param isFullScreen - Whether the widget is in full screen mode\n */\nfunction DataFrame({\n  element,\n  data,\n  width: containerWidth,\n  height: containerHeight,\n  disabled,\n  widgetMgr,\n  isFullScreen,\n}: DataFrameProps): ReactElement {\n  const resizableRef = React.useRef<Resizable>(null)\n  const dataEditorRef = React.useRef<DataEditorRef>(null)\n\n  const extraCellArgs = useExtraCells()\n  const theme = useCustomTheme()\n\n  const [isFocused, setIsFocused] = React.useState<boolean>(true)\n\n  const [gridSelection, setGridSelection] = React.useState<GridSelection>({\n    columns: CompactSelection.empty(),\n    rows: CompactSelection.empty(),\n    current: undefined,\n  })\n\n  // This callback is used to clear all selections (row/column/cell)\n  const clearSelection = React.useCallback(() => {\n    setGridSelection({\n      columns: CompactSelection.empty(),\n      rows: CompactSelection.empty(),\n      current: undefined,\n    })\n  }, [])\n\n  // This callback is used to refresh the rendering of selected cells\n  const refreshCells = React.useCallback(\n    (\n      cells: {\n        cell: [number, number]\n      }[]\n    ) => {\n      dataEditorRef.current?.updateCells(cells)\n    },\n    []\n  )\n\n  // This is done to keep some backwards compatibility\n  // so that old arrow proto messages from the st.dataframe\n  // would still work. Those messages don't have the\n  // editingMode field defined.\n  if (isNullOrUndefined(element.editingMode)) {\n    element.editingMode = ArrowProto.EditingMode.READ_ONLY\n  }\n\n  const { READ_ONLY, DYNAMIC } = ArrowProto.EditingMode\n\n  // Number of rows of the table minus 1 for the header row:\n  const dataDimensions = data.dimensions\n  const originalNumRows = Math.max(0, dataDimensions.rows - 1)\n\n  // For empty tables, we show an extra row that\n  // contains \"empty\" as a way to indicate that the table is empty.\n  const isEmptyTable =\n    originalNumRows === 0 &&\n    // We don't show empty state for dynamic mode with a table that has\n    // data columns defined.\n    !(element.editingMode === DYNAMIC && dataDimensions.dataColumns > 0)\n\n  // For large tables, we apply some optimizations to handle large data\n  const isLargeTable = originalNumRows > LARGE_TABLE_ROWS_THRESHOLD\n\n  const editingState = React.useRef<EditingState>(\n    new EditingState(originalNumRows)\n  )\n\n  const [numRows, setNumRows] = React.useState(\n    editingState.current.getNumRows()\n  )\n\n  React.useEffect(() => {\n    editingState.current = new EditingState(originalNumRows)\n    setNumRows(editingState.current.getNumRows())\n  }, [originalNumRows])\n\n  const resetEditingState = React.useCallback(() => {\n    editingState.current = new EditingState(originalNumRows)\n    setNumRows(editingState.current.getNumRows())\n  }, [originalNumRows])\n\n  const { columns: originalColumns, getCellContent: getOriginalCellContent } =\n    useDataLoader(element, data, numRows, disabled, editingState)\n\n  const { columns, sortColumn, getOriginalIndex, getCellContent } =\n    useColumnSort(originalNumRows, originalColumns, getOriginalCellContent)\n\n  /**\n   * This callback should be called after any edits have been applied to the data.\n   * It will finish up the editing by updating the number of rows, clearing the selection,\n   * and triggering a rerun of the script.\n   *\n   * @param clearSelections - Whether to clear the selection. This is usually done after deleting rows.\n   * @param triggerRerun - Whether to trigger a rerun of the script after applying edits\n   */\n  const applyEdits = React.useCallback(\n    (clearSelections = false, triggerRerun = true) => {\n      if (numRows !== editingState.current.getNumRows()) {\n        // Reset the number of rows if it has been changed in the editing state\n        setNumRows(editingState.current.getNumRows())\n      }\n\n      if (clearSelections) {\n        clearSelection()\n      }\n\n      if (triggerRerun) {\n        // Use debounce to prevent rapid updates to the widget state.\n        debounce(DEBOUNCE_TIME_MS, () => {\n          const currentEditingState = editingState.current.toJson(columns)\n          let currentWidgetState = widgetMgr.getStringValue(\n            element as WidgetInfo\n          )\n\n          if (currentWidgetState === undefined) {\n            // Create an empty widget state\n            currentWidgetState = new EditingState(0).toJson([])\n          }\n\n          // Only update if there is actually a difference between editing and widget state\n          if (currentEditingState !== currentWidgetState) {\n            widgetMgr.setStringValue(\n              element as WidgetInfo,\n              currentEditingState,\n              {\n                fromUi: true,\n              }\n            )\n          }\n        })()\n      }\n    },\n    [widgetMgr, element, numRows]\n  )\n\n  const { onCellEdited, onPaste, onRowAppended, onDelete } = useDataEditor(\n    columns,\n    element.editingMode !== DYNAMIC,\n    editingState,\n    getCellContent,\n    getOriginalIndex,\n    refreshCells,\n    applyEdits\n  )\n\n  const { columns: glideColumns, onColumnResize } = useColumnSizer(\n    columns.map(column => toGlideColumn(column))\n  )\n\n  const {\n    rowHeight,\n    minHeight,\n    maxHeight,\n    minWidth,\n    maxWidth,\n    resizableSize,\n    setResizableSize,\n  } = useTableSizer(\n    element,\n    numRows,\n    containerWidth,\n    containerHeight,\n    isFullScreen\n  )\n\n  // This is used as fallback in case the table is empty to\n  // insert cells indicating this state:\n  const getEmptyStateContent = React.useCallback(\n    ([_col, _row]: readonly [number, number]): GridCell => {\n      return {\n        ...getTextCell(true, false),\n        displayData: \"empty\",\n        contentAlign: \"center\",\n        allowOverlay: false,\n        themeOverride: {\n          textDark: theme.textLight,\n        },\n        span: [0, Math.max(columns.length - 1, 0)],\n      } as GridCell\n    },\n    [columns]\n  )\n\n  // This is required for the form clearing functionality:\n  React.useEffect(() => {\n    const formClearHelper = new FormClearHelper()\n    formClearHelper.manageFormClearListener(\n      widgetMgr,\n      element.formId,\n      resetEditingState\n    )\n\n    return () => {\n      formClearHelper.disconnect()\n    }\n  }, [])\n\n  return (\n    <StyledResizableContainer\n      className=\"stDataFrame\"\n      onBlur={() => {\n        // If the container loses focus, clear the current selection\n        if (!isFocused) {\n          clearSelection()\n        }\n      }}\n    >\n      <Resizable\n        data-testid=\"stDataFrameResizable\"\n        ref={resizableRef}\n        defaultSize={resizableSize}\n        style={{\n          border: `1px solid ${theme.borderColor}`,\n          borderRadius: `${theme.tableBorderRadius}`,\n        }}\n        minHeight={minHeight}\n        maxHeight={maxHeight}\n        minWidth={minWidth}\n        maxWidth={maxWidth}\n        size={resizableSize}\n        enable={{\n          top: false,\n          right: false,\n          bottom: false,\n          left: false,\n          topRight: false,\n          bottomRight: true,\n          bottomLeft: false,\n          topLeft: false,\n        }}\n        grid={[1, rowHeight]}\n        snapGap={rowHeight / 3}\n        onResizeStop={(_event, _direction, _ref, _delta) => {\n          if (resizableRef.current) {\n            setResizableSize({\n              width: resizableRef.current.size.width,\n              height:\n                // Add an additional pixel if it is stretched to full width\n                // to allow the full cell border to be visible\n                maxHeight - resizableRef.current.size.height === 3\n                  ? resizableRef.current.size.height + 3\n                  : resizableRef.current.size.height,\n            })\n          }\n        }}\n      >\n        <GlideDataEditor\n          className=\"glideDataEditor\"\n          ref={dataEditorRef}\n          columns={glideColumns}\n          rows={isEmptyTable ? 1 : numRows}\n          minColumnWidth={MIN_COLUMN_WIDTH}\n          maxColumnWidth={MAX_COLUMN_WIDTH}\n          maxColumnAutoWidth={MAX_COLUMN_AUTO_WIDTH}\n          rowHeight={rowHeight}\n          headerHeight={rowHeight}\n          getCellContent={isEmptyTable ? getEmptyStateContent : getCellContent}\n          onColumnResize={onColumnResize}\n          // Freeze all index columns:\n          freezeColumns={\n            isEmptyTable\n              ? 0\n              : columns.filter((col: BaseColumn) => col.isIndex).length\n          }\n          smoothScrollX={true}\n          smoothScrollY={true}\n          // Show borders between cells:\n          verticalBorder={(col: number) =>\n            // Show no border for last column in certain situations\n            // This is required to prevent the cell selection border to not be cut off\n            !(\n              col >= columns.length &&\n              (element.useContainerWidth || resizableSize.width === \"100%\")\n            )\n          }\n          // Activate copy to clipboard functionality:\n          getCellsForSelection={true}\n          // Deactivate row markers and numbers:\n          rowMarkers={\"none\"}\n          // Deactivate selections:\n          rangeSelect={\"rect\"}\n          columnSelect={\"none\"}\n          rowSelect={\"none\"}\n          // Activate search:\n          keybindings={{ search: true, downFill: true }}\n          // Header click is used for column sorting:\n          onHeaderClicked={\n            // Deactivate sorting for empty state and for large dataframes:\n            isEmptyTable || isLargeTable ? undefined : sortColumn\n          }\n          gridSelection={gridSelection}\n          onGridSelectionChange={setGridSelection}\n          // Apply different styling to missing cells:\n          drawCell={drawMissingCells}\n          theme={theme}\n          onMouseMove={(args: GridMouseEventArgs) => {\n            // Determine if the dataframe is focused or not\n            if (args.kind === \"out-of-bounds\" && isFocused) {\n              setIsFocused(false)\n            } else if (args.kind !== \"out-of-bounds\" && !isFocused) {\n              setIsFocused(true)\n            }\n          }}\n          // Add shadow for index columns and header on scroll:\n          fixedShadowX={true}\n          fixedShadowY={true}\n          experimental={{\n            // We use an overlay scrollbar, so no need to have space for reserved for the scrollbar:\n            scrollbarWidthOverride: 1,\n          }}\n          // Add support for additional cells:\n          customRenderers={extraCellArgs.customRenderers}\n          // The default setup is read only, and therefore we deactivate paste here:\n          onPaste={false}\n          // If element is editable, enable editing features:\n          {...(!isEmptyTable &&\n            element.editingMode !== READ_ONLY &&\n            !disabled && {\n              // Support fill handle for bulk editing:\n              fillHandle: true,\n              // Support editing:\n              onCellEdited,\n              // Support pasting data for bulk editing:\n              onPaste,\n              // Support deleting cells & rows:\n              onDelete,\n            })}\n          // If element is dynamic, enable adding & deleting rows:\n          {...(!isEmptyTable &&\n            element.editingMode === DYNAMIC && {\n              // Support adding rows:\n              trailingRowOptions: {\n                sticky: false,\n                tint: true,\n              },\n              rowMarkerTheme: {\n                bgCell: theme.bgHeader,\n                bgCellMedium: theme.bgHeader,\n              },\n              rowMarkers: \"checkbox\",\n              rowSelectionMode: \"auto\",\n              rowSelect: disabled ? \"none\" : \"multi\",\n              // Support adding rows:\n              onRowAppended: disabled ? undefined : onRowAppended,\n              // Deactivate sorting, since it is not supported with dynamic editing:\n              onHeaderClicked: undefined,\n            })}\n        />\n      </Resizable>\n    </StyledResizableContainer>\n  )\n}\n\nexport default withFullScreenWrapper(DataFrame)\n"],"names":["numRows","editedCells","Map","addedRows","deletedRows","this","columns","columnsByIndex","forEach","column","set","indexNumber","currentState","edited_cells","added_rows","deleted_rows","row","rowIndex","_map","cell","colIndex","get","getCellValue","addedRow","cellValue","notNullOrUndefined","push","JSON","stringify","k","v","undefined","col","isAddedRow","rowCache","length","rowCells","rows","sort","a","b","deleteRow","isNullOrUndefined","splice","includes","delete","originalIndex","i","theme","useTheme","accentColor","colors","primary","accentFg","white","accentLight","transparentize","borderColor","fadedText05","horizontalBorderColor","fontFamily","genericFonts","bodyFont","bgSearchResult","bgIconHeader","fadedText60","fgIconHeader","bgHeader","bgMix","bgHeaderHasFocus","secondaryBg","bgHeaderHovered","textHeader","textHeaderSelected","textGroupHeader","headerFontStyle","fontSizes","sm","baseFontStyle","editorFontSize","textDark","bodyText","textMedium","textLight","fadedText40","textBubble","bgCell","bgColor","bgCellMedium","cellHorizontalPadding","cellVerticalPadding","bgBubble","bgBubbleSelected","linkColor","linkText","drilldownBorder","darkenedBgMix25","tableBorderRadius","radii","md","getErrorCell","errorMsg","errorDetails","kind","GridCellKind","readonly","allowOverlay","data","displayData","isError","isErrorCell","hasOwnProperty","toGlideColumn","id","title","hasMenu","themeOverride","isStretched","grow","isIndex","width","mergeColumnParameters","defaultParams","userParams","merge","toSafeArray","trim","startsWith","endsWith","split","parse","error","parsedData","_key","value","Number","isArray","map","toSafeString","toString","formatNumber","maxPrecision","keepTrailingZeros","isNaN","isFinite","Math","round","numbro","format","repeat","ObjectColumn","props","cellTemplate","contentAlignment","style","sortMode","isEditable","getCell","cellData","isMissingValue","isEditableType","TextColumn","BOOLEAN_TRUE_VALUES","BOOLEAN_FALSE_VALUES","BooleanColumn","contentAlign","cleanedValue","String","toLowerCase","CategoricalColumn","parameters","options","Quiver","arrowType","columnTypeMetadata","copyData","allowedValues","filter","opt","ListColumn","NumberColumn","arrowTypeName","precision","min","allowNegative","fixedDecimals","NaN","unformattedValue","Int32Array","toSafeNumber","trunc","max","ColumnTypes","Object","entries","object","text","boolean","categorical","list","number","extractCssProperty","htmlElementId","property","cssStyle","regex","RegExp","replace","match","exec","processDisplayData","getIndexFromArrow","indexPosition","types","index","indexNames","isHidden","getColumnFromArrow","columnPosition","meta","numpy_type","pandas_type","getCategoricalOptions","getCellFromArrow","arrowCell","cssStyles","content","contentType","field","displayContent","cssId","fontColor","backgroundColor","applyPandasStylerCss","INDEX_IDENTIFIER","COLUMN_POSITION_PREFIX","getColumnType","ColumnType","customType","has","logWarning","typeName","getColumnTypeFromArrow","element","disabled","editingState","columnConfigMapping","logError","getColumnConfig","stretchColumns","useContainerWidth","configuredColumns","numIndices","numColumns","getAllColumnsFromArrow","updatedColumn","columnProps","columnConfig","type","editable","hidden","metadata","alignment","applyColumnConfig","editingMode","ArrowProto","getCellContent","React","originalCol","originalRow","current","getOriginalRowIndex","editedCell","ROW_HEIGHT","MIN_TABLE_WIDTH","MIN_TABLE_HEIGHT","DEFAULT_TABLE_HEIGHT","containerWidth","containerHeight","isFullScreen","initialWidth","maxHeight","calculateMaxHeight","initialHeight","height","maxWidth","resizableSize","setResizableSize","rowHeight","minHeight","minWidth","fixedNumRows","getOriginalIndex","refreshCells","applyEdits","onCellEdited","updatedCell","currentCell","currentValue","newValue","newCell","setCell","lastUpdated","performance","now","onRowAppended","newRow","addRow","onDelete","selection","rowsToDelete","toArray","deleteRows","range","updatedCells","selectedArea","y","x","onPaste","target","values","targetCol","targetRow","rowData","getNumRows","pasteDataValue","useState","columnSizes","setColumnSizes","onColumnResize","_newSize","_colIndex","newSizeWithGrow","setSort","useGlideColumnSort","getCellContentSorted","updatedColumns","direction","updateSortingHeader","sortColumn","sortDirection","clickedColumn","mode","StyledResizableContainer","position","display","borderRadius","scrollbarWidth","MIN_COLUMN_WIDTH","MAX_COLUMN_WIDTH","MAX_COLUMN_AUTO_WIDTH","DEBOUNCE_TIME_MS","LARGE_TABLE_ROWS_THRESHOLD","drawMissingCells","args","isMissingValueCell","drawTextCell","spriteManager","hyperWrapping","withFullScreenWrapper","widgetMgr","resizableRef","dataEditorRef","extraCellArgs","useExtraCells","useCustomTheme","isFocused","setIsFocused","CompactSelection","gridSelection","setGridSelection","clearSelection","cells","updateCells","READ_ONLY","DYNAMIC","dataDimensions","dimensions","originalNumRows","isEmptyTable","dataColumns","isLargeTable","EditingState","setNumRows","resetEditingState","useDataLoader","originalColumns","getOriginalCellContent","useColumnSort","clearSelections","triggerRerun","debounce","currentEditingState","toJson","currentWidgetState","getStringValue","setStringValue","fromUi","useDataEditor","useColumnSizer","glideColumns","useTableSizer","getEmptyStateContent","faded","getTextCell","span","formClearHelper","FormClearHelper","manageFormClearListener","formId","disconnect","className","onBlur","ref","defaultSize","border","size","enable","top","right","bottom","left","topRight","bottomRight","bottomLeft","topLeft","grid","snapGap","onResizeStop","_event","_direction","_ref","_delta","minColumnWidth","maxColumnWidth","maxColumnAutoWidth","headerHeight","freezeColumns","smoothScrollX","smoothScrollY","verticalBorder","getCellsForSelection","rowMarkers","rangeSelect","columnSelect","rowSelect","keybindings","search","downFill","onHeaderClicked","onGridSelectionChange","drawCell","onMouseMove","fixedShadowX","fixedShadowY","experimental","scrollbarWidthOverride","customRenderers","fillHandle","trailingRowOptions","sticky","tint","rowMarkerTheme","rowSelectionMode"],"sourceRoot":""}